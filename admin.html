<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <title>Admin Panel - London Marketplace</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .admin-sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            width: 250px;
            height: calc(100vh - 70px);
            background: var(--primary-color);
            padding: 20px;
            overflow-y: auto;
        }

        .admin-nav-item {
            display: block;
            color: white;
            text-decoration: none;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            transition: background 0.2s ease;
            cursor: pointer;
        }

        .admin-nav-item:hover, .admin-nav-item.active {
            background: var(--accent-color);
            color: var(--text-primary);
        }

        .admin-content {
            margin-left: 250px;
            padding: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .data-table {
            width: 100%;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: var(--secondary-color);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover {
            background: var(--bg-light);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .loading-row {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .admin-sidebar {
                width: 100%;
                position: relative;
                top: 0;
                height: auto;
            }

            .admin-content {
                margin-left: 0;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 32px;
            color: #6b7280;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .close-modal:hover {
            color: var(--primary-color);
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group textarea {
            resize: vertical;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.1);
        }

        /* Role selection styling */
        #roleModal label:has(input[type="radio"]:checked) {
            border-color: var(--accent-color) !important;
            background: rgba(255, 153, 0, 0.05);
        }

        #roleModal label:hover {
            border-color: var(--accent-color);
            background: rgba(255, 153, 0, 0.02);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-main">
            <button class="mobile-menu-toggle" id="adminMenuToggle" onclick="toggleAdminSidebar()">
                â˜°
            </button>
            <div class="logo-container" onclick="confirmLeave('index.html')">
                <img src="images/logo-icon-new.svg" alt="London Marketplace">
            </div>
            <div style="flex: 1; padding-left: 20px;">
                <span style="color: white; font-size: 18px; font-weight: 600;">Admin Panel</span>
            </div>
            <nav class="header-nav">
                <a href="#" onclick="confirmLeave('marketplace.html'); return false;" class="nav-link">View Marketplace</a>
                <a href="#" class="nav-link" onclick="handleLogout(); return false;">Sign Out</a>
            </nav>
        </div>
    </header>

    <!-- Admin Sidebar Overlay (for mobile) -->
    <div class="admin-overlay" id="adminOverlay" onclick="toggleAdminSidebar()"></div>

    <!-- Admin Sidebar -->
    <div class="admin-sidebar">
        <div class="admin-nav-item active" onclick="switchTab('dashboard', event)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 10px; pointer-events: none;">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
            </svg>
            Dashboard
        </div>
        <div class="admin-nav-item" onclick="switchTab('products', event)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 10px; pointer-events: none;">
                <path d="M20 7H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2z"/>
            </svg>
            Products
        </div>
        <div class="admin-nav-item" onclick="switchTab('users', event)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 10px; pointer-events: none;">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            Users
        </div>
        <div class="admin-nav-item" onclick="switchTab('sellers', event)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 10px; pointer-events: none;">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <circle cx="16" cy="7" r="2"/>
            </svg>
            Seller Approvals
        </div>
        <div class="admin-nav-item" onclick="switchTab('orders', event)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 10px; pointer-events: none;">
                <circle cx="9" cy="21" r="1"/>
                <circle cx="20" cy="21" r="1"/>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
            Orders
        </div>
        <div class="admin-nav-item" onclick="switchTab('homepage', event)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 10px; pointer-events: none;">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M3 9h18M9 21V9"/>
            </svg>
            Customise Backgrounds
        </div>
        <div class="admin-nav-item" onclick="switchTab('settings', event)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 10px; pointer-events: none;">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
            </svg>
            Settings
        </div>
    </div>

    <!-- Admin Content -->
    <div class="admin-content">
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <h1 style="margin-bottom: 30px;">Dashboard Overview</h1>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">$<span id="totalRevenue">0.00</span></div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>

            <div class="grid grid-2 mt-20">
                <div class="card">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity" style="margin-top: 20px; color: var(--text-secondary);">
                        <p>No recent activity</p>
                    </div>
                </div>
                <div class="card">
                    <h3>Quick Actions</h3>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="switchTab('products', event)">Manage Products</button>
                        <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;" onclick="switchTab('users', event)">Manage Users</button>
                        <button class="btn btn-secondary" style="width: 100%;" onclick="switchTab('orders', event)">View Orders</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div class="tab-content" id="products">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h1 style="margin: 0;">Product Management</h1>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="openAdminBulkUploadModal()" style="padding: 12px 24px;">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 8px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Bulk Upload
                    </button>
                    <button class="btn btn-primary" onclick="openAddProductModal()" style="padding: 12px 24px;">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 8px;">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Product
                    </button>
                </div>
            </div>

            <!-- Products Search -->
            <div style="margin-bottom: 20px;">
                <div style="position: relative; max-width: 500px;">
                    <input type="text" id="productSearch" placeholder="Search products by name, category, or seller..."
                           onkeyup="searchProducts()" onfocus="this.style.borderColor='var(--accent-color)'; this.style.boxShadow='0 0 0 3px rgba(255, 153, 0, 0.1)'" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                           style="width: 100%; padding: 12px 45px 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; transition: all 0.3s ease;">
                    <svg width="20" height="20" fill="none" stroke="#6b7280" stroke-width="2" viewBox="0 0 24 24"
                         style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none;">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                </div>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Seller</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <tr>
                            <td colspan="8" class="loading-row">Loading products...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Users Tab -->
        <div class="tab-content" id="users">
            <h1 style="margin-bottom: 30px;">User Management</h1>

            <!-- Users Search -->
            <div style="margin-bottom: 20px;">
                <div style="position: relative; max-width: 500px;">
                    <input type="text" id="userSearch" placeholder="Search users by name, email, or role..."
                           onkeyup="searchUsers()" onfocus="this.style.borderColor='var(--accent-color)'; this.style.boxShadow='0 0 0 3px rgba(255, 153, 0, 0.1)'" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                           style="width: 100%; padding: 12px 45px 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; transition: all 0.3s ease;">
                    <svg width="20" height="20" fill="none" stroke="#6b7280" stroke-width="2" viewBox="0 0 24 24"
                         style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none;">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                </div>
            </div>

            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Full Name</th>
                            <th>Role</th>
                            <th>Created Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr>
                            <td colspan="5" class="loading-row">Loading users...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Seller Approvals Tab -->
        <div class="tab-content" id="sellers">
            <h1 style="margin-bottom: 30px;">Seller Account Approvals</h1>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Full Name</th>
                            <th>Status</th>
                            <th>Created Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sellersTableBody">
                        <tr>
                            <td colspan="5" class="loading-row">Loading pending sellers...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Orders Tab -->
        <div class="tab-content" id="orders">
            <h1 style="margin-bottom: 30px;">Order Management</h1>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Buyer</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <tr>
                            <td colspan="6" class="loading-row">Loading orders...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <h1 style="margin-bottom: 30px;">Platform Settings</h1>

            <!-- General Settings -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">General Settings</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Basic platform configuration</p>

                <form id="generalSettingsForm" style="margin-top: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Platform Name</label>
                            <input type="text" id="platformName" placeholder="London Star Marketplace" required>
                        </div>
                        <div class="form-group">
                            <label>Platform Tagline</label>
                            <input type="text" id="platformTagline" placeholder="Premium Marketplace for Quality Products">
                        </div>
                        <div class="form-group">
                            <label>Support Email</label>
                            <input type="email" id="platformEmail" placeholder="support@londonstar.com" required>
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="platformPhone" placeholder="+1 (555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label>Currency</label>
                            <select id="currency" required>
                                <option value="USD">USD - US Dollar</option>
                                <option value="JMD">JMD - Jamaican Dollar</option>
                                <option value="GBP">GBP - British Pound</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="CAD">CAD - Canadian Dollar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Timezone</label>
                            <select id="timezone">
                                <option value="America/Jamaica">America/Jamaica (GMT-5)</option>
                                <option value="America/New_York">America/New_York (EST)</option>
                                <option value="America/Los_Angeles">America/Los_Angeles (PST)</option>
                                <option value="Europe/London">Europe/London (GMT)</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Platform Description (SEO)</label>
                        <textarea id="platformDescription" rows="3" placeholder="A premium e-commerce marketplace offering quality products worldwide..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save General Settings</button>
                </form>
            </div>

            <!-- Business Settings -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Business Settings</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Commission, fees, and business rules</p>

                <form id="businessSettingsForm" style="margin-top: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Commission Rate (%)</label>
                            <input type="number" id="commissionRate" min="0" max="100" step="0.01" placeholder="5.00" required>
                            <small style="color: #6b7280;">Percentage charged on each sale</small>
                        </div>
                        <div class="form-group">
                            <label>Minimum Order Amount</label>
                            <input type="number" id="minOrderAmount" min="0" step="0.01" placeholder="10.00">
                            <small style="color: #6b7280;">Minimum order value (leave blank for no minimum)</small>
                        </div>
                        <div class="form-group">
                            <label>Shipping Fee</label>
                            <input type="number" id="shippingFee" min="0" step="0.01" placeholder="5.00">
                            <small style="color: #6b7280;">Flat shipping rate (0 for free shipping)</small>
                        </div>
                        <div class="form-group">
                            <label>Free Shipping Threshold</label>
                            <input type="number" id="freeShippingThreshold" min="0" step="0.01" placeholder="50.00">
                            <small style="color: #6b7280;">Order value for free shipping</small>
                        </div>
                        <div class="form-group">
                            <label>Tax Rate (%)</label>
                            <input type="number" id="taxRate" min="0" max="100" step="0.01" placeholder="0.00">
                            <small style="color: #6b7280;">Sales tax percentage</small>
                        </div>
                        <div class="form-group">
                            <label>Max Products Per Page</label>
                            <input type="number" id="productsPerPage" min="6" max="100" step="6" value="24">
                            <small style="color: #6b7280;">Number of products to display per page</small>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Business Settings</button>
                </form>
            </div>

            <!-- Seller Settings -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Seller Settings</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Seller application and management settings</p>

                <form id="sellerSettingsForm" style="margin-top: 20px;">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="autoApproveSellers" style="width: auto;">
                            <span>Auto-approve seller applications</span>
                        </label>
                        <small style="color: #6b7280; display: block; margin-top: 4px; margin-left: 30px;">
                            If enabled, sellers are automatically approved without admin review
                        </small>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="requireSellerVerification" style="width: auto;">
                            <span>Require seller identity verification</span>
                        </label>
                        <small style="color: #6b7280; display: block; margin-top: 4px; margin-left: 30px;">
                            Sellers must verify their identity before listing products
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Maximum Products Per Seller</label>
                        <input type="number" id="maxProductsPerSeller" min="1" step="1" placeholder="100">
                        <small style="color: #6b7280;">Leave blank for unlimited products</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Seller Settings</button>
                </form>
            </div>

            <!-- Feature Toggles -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Feature Toggles</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Enable or disable platform features</p>

                <form id="featureSettingsForm" style="margin-top: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="enableReviews" style="width: auto;" checked>
                                <span>Enable Product Reviews</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="enableWishlist" style="width: auto;" checked>
                                <span>Enable Wishlist</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="enableGuestCheckout" style="width: auto;">
                                <span>Enable Guest Checkout</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="enableNewsletter" style="width: auto;" checked>
                                <span>Enable Newsletter Signup</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="enableLiveChat" style="width: auto;">
                                <span>Enable Live Chat Support</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="maintenanceMode" style="width: auto;">
                                <span>Maintenance Mode</span>
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Feature Settings</button>
                </form>
            </div>

            <!-- Social Media & Contact -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Social Media & Links</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Social media profiles and external links</p>

                <form id="socialSettingsForm" style="margin-top: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Facebook URL</label>
                            <input type="url" id="facebookUrl" placeholder="https://facebook.com/yourpage">
                        </div>
                        <div class="form-group">
                            <label>Instagram URL</label>
                            <input type="url" id="instagramUrl" placeholder="https://instagram.com/yourpage">
                        </div>
                        <div class="form-group">
                            <label>Twitter/X URL</label>
                            <input type="url" id="twitterUrl" placeholder="https://twitter.com/yourpage">
                        </div>
                        <div class="form-group">
                            <label>LinkedIn URL</label>
                            <input type="url" id="linkedinUrl" placeholder="https://linkedin.com/company/yourpage">
                        </div>
                        <div class="form-group">
                            <label>YouTube URL</label>
                            <input type="url" id="youtubeUrl" placeholder="https://youtube.com/@yourpage">
                        </div>
                        <div class="form-group">
                            <label>TikTok URL</label>
                            <input type="url" id="tiktokUrl" placeholder="https://tiktok.com/@yourpage">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Physical Address</label>
                        <textarea id="physicalAddress" rows="2" placeholder="123 Main Street, Kingston, Jamaica"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Social Media Settings</button>
                </form>
            </div>

            <!-- Email Notifications -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Email Notifications</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Configure automated email notifications</p>

                <form id="emailSettingsForm" style="margin-top: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="emailOrderConfirmation" style="width: auto;" checked>
                                <span>Order Confirmation Emails</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="emailShippingUpdate" style="width: auto;" checked>
                                <span>Shipping Update Emails</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="emailSellerApproval" style="width: auto;" checked>
                                <span>Seller Approval Emails</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="emailNewOrder" style="width: auto;" checked>
                                <span>New Order Notifications (to Admin)</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="emailLowStock" style="width: auto;">
                                <span>Low Stock Alerts (to Sellers)</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="emailWeeklyReport" style="width: auto;">
                                <span>Weekly Sales Reports</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 16px;">
                        <label>Email From Name</label>
                        <input type="text" id="emailFromName" placeholder="London Star Marketplace">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Email Settings</button>
                </form>
            </div>

            <!-- SEO Settings -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">SEO & Meta Tags</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Search engine optimization settings</p>

                <form id="seoSettingsForm" style="margin-top: 20px;">
                    <div class="form-group">
                        <label>Meta Title</label>
                        <input type="text" id="metaTitle" placeholder="London Star Marketplace - Premium Products Online" maxlength="60">
                        <small style="color: #6b7280;">Recommended: 50-60 characters</small>
                    </div>
                    <div class="form-group">
                        <label>Meta Description</label>
                        <textarea id="metaDescription" rows="3" placeholder="Shop premium quality products from trusted sellers worldwide. Fast shipping, secure payment, and excellent customer service." maxlength="160"></textarea>
                        <small style="color: #6b7280;">Recommended: 150-160 characters</small>
                    </div>
                    <div class="form-group">
                        <label>Meta Keywords</label>
                        <input type="text" id="metaKeywords" placeholder="marketplace, ecommerce, online shopping, premium products">
                        <small style="color: #6b7280;">Comma-separated keywords</small>
                    </div>
                    <div class="form-group">
                        <label>Google Analytics ID</label>
                        <input type="text" id="googleAnalyticsId" placeholder="G-XXXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label>Facebook Pixel ID</label>
                        <input type="text" id="facebookPixelId" placeholder="123456789012345">
                    </div>
                    <button type="submit" class="btn btn-primary">Save SEO Settings</button>
                </form>
            </div>

        </div>

        <!-- Customise Backgrounds Tab -->
        <div class="tab-content" id="homepage">
            <h1 style="margin-bottom: 30px;">Customise Backgrounds</h1>

            <!-- Hero Background Section -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Hero Background Image</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Upload a background image for the homepage hero section (JPG, PNG, GIF - max 5MB)</p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Upload Section -->
                    <div>
                        <div class="form-group">
                            <label>Upload Background Image</label>
                            <input type="file" id="heroBackgroundInput" accept="image/*" onchange="previewHeroBackground(this)">
                        </div>

                        <div id="heroBackgroundPreview" style="display: none; margin-top: 12px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Preview</label>
                            <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; height: 200px; background-size: cover; background-position: center; position: relative;">
                                <img id="heroPreviewImage" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </div>

                        <div style="margin-top: 16px; display: flex; gap: 12px;">
                            <button class="btn btn-primary" onclick="saveHeroBackground()" id="saveHeroBtn">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Save Background
                            </button>
                            <button class="btn btn-secondary" onclick="removeHeroBackground()" id="removeHeroBtn">
                                Remove Background
                            </button>
                        </div>
                    </div>

                    <!-- Current Background Section -->
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Current Background</label>
                        <div id="currentHeroBackground" style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; height: 200px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; color: #6b7280; background-size: cover; background-position: center;">
                            No background set
                        </div>
                        <div style="margin-top: 12px; padding: 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px;">
                            <p style="margin: 0; font-size: 13px; color: #6b7280;">
                                <strong>Tip:</strong> Use a high-quality image (1920x600px recommended) for best results. The image will be used as the background for the hero banner section.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Auth/Login Page Background Section -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Login Page Background Image</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Upload a background image for the login/authentication page (JPG, PNG, GIF - max 5MB)</p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Upload Section -->
                    <div>
                        <div class="form-group">
                            <label>Upload Background Image</label>
                            <input type="file" id="authBackgroundInput" accept="image/*" onchange="previewAuthBackground(this)">
                        </div>

                        <div id="authBackgroundPreview" style="display: none; margin-top: 12px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Preview</label>
                            <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; height: 200px; background-size: cover; background-position: center; position: relative;">
                                <img id="authPreviewImage" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </div>

                        <div style="margin-top: 16px; display: flex; gap: 12px;">
                            <button class="btn btn-primary" onclick="saveAuthBackground()" id="saveAuthBtn">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Save Background
                            </button>
                            <button class="btn btn-secondary" onclick="removeAuthBackground()" id="removeAuthBtn">
                                Remove Background
                            </button>
                        </div>
                    </div>

                    <!-- Current Background Section -->
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Current Background</label>
                        <div id="currentAuthBackground" style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; height: 200px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; color: #6b7280; background-size: cover; background-position: center;">
                            No background set
                        </div>
                        <div style="margin-top: 12px; padding: 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px;">
                            <p style="margin: 0; font-size: 13px; color: #6b7280;">
                                <strong>Tip:</strong> Use a high-quality image (1920x1080px recommended) for best results. The image will replace the default floating bubbles on the login page.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Marketplace Hero Background Section -->
            <div class="card" style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 8px 0;">Marketplace Hero Customization</h3>
                <p style="color: #6b7280; margin: 0 0 20px 0;">Customize the marketplace hero section background and text colors</p>

                <!-- Text Color Settings -->
                <div style="margin-bottom: 30px; padding: 20px; background: #f9fafb; border-radius: 8px;">
                    <h4 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600;">Text Colors</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label>Title Color</label>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <input type="color" id="marketplaceTitleColor" value="#ffffff" style="width: 60px; height: 40px; border-radius: 6px; border: 2px solid #e5e7eb; cursor: pointer;">
                                <input type="text" id="marketplaceTitleColorHex" value="#ffffff" placeholder="#ffffff" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-family: monospace;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Subtitle Color</label>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <input type="color" id="marketplaceSubtitleColor" value="#ffffff" style="width: 60px; height: 40px; border-radius: 6px; border: 2px solid #e5e7eb; cursor: pointer;">
                                <input type="text" id="marketplaceSubtitleColorHex" value="#ffffff" placeholder="#ffffff" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-family: monospace;">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveMarketplaceTextColors()" style="margin-top: 16px;">Save Text Colors</button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Upload Section -->
                    <div>
                        <div class="form-group">
                            <label>Upload Background Image</label>
                            <input type="file" id="marketplaceHeroInput" accept="image/*" onchange="previewMarketplaceHero(this)">
                        </div>

                        <div id="marketplaceHeroPreview" style="display: none; margin-top: 12px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Preview</label>
                            <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; height: 200px; background-size: cover; background-position: center; position: relative;">
                                <img id="marketplacePreviewImage" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </div>

                        <div style="margin-top: 16px; display: flex; gap: 12px;">
                            <button class="btn btn-primary" onclick="saveMarketplaceHero()" id="saveMarketplaceHeroBtn">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Save Background
                            </button>
                            <button class="btn btn-secondary" onclick="removeMarketplaceHero()" id="removeMarketplaceHeroBtn">
                                Remove Background
                            </button>
                        </div>
                    </div>

                    <!-- Current Background Section -->
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Current Background</label>
                        <div id="currentMarketplaceHero" style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; height: 200px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; color: #6b7280; background-size: cover; background-position: center;">
                            No background set
                        </div>
                        <div style="margin-top: 12px; padding: 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px;">
                            <p style="margin: 0; font-size: 13px; color: #6b7280;">
                                <strong>Tip:</strong> Use a high-quality image (1920x400px recommended) for the marketplace hero section.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 480px; text-align: center;">
            <div style="margin-bottom: 20px;">
                <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: rgba(249, 115, 22, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg width="32" height="32" fill="none" stroke="#f97316" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <h3 id="confirmTitle" style="font-size: 20px; font-weight: 600; color: var(--primary-color); margin: 0 0 12px 0;"></h3>
                <p id="confirmMessage" style="color: #6b7280; font-size: 15px; line-height: 1.5; margin: 0;"></p>
            </div>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <button class="btn btn-secondary" onclick="closeConfirmModal(false)" style="min-width: 120px;">Cancel</button>
                <button class="btn btn-primary" id="confirmBtn" onclick="closeConfirmModal(true)" style="min-width: 120px; background: #dc2626;">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Change Role Modal -->
    <div id="roleModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 480px;">
            <div class="modal-header">
                <h2>Change User Role</h2>
                <button class="close-modal" onclick="closeRoleModal()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <p style="color: #6b7280; margin-bottom: 20px;">Select new role for this user:</p>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                        <input type="radio" name="userRole" value="buyer" style="margin-right: 12px; width: 18px; height: 18px; accent-color: var(--accent-color);">
                        <div>
                            <div style="font-weight: 600; color: var(--primary-color);">Buyer</div>
                            <div style="font-size: 13px; color: #6b7280;">Can browse and purchase products</div>
                        </div>
                    </label>
                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                        <input type="radio" name="userRole" value="seller" style="margin-right: 12px; width: 18px; height: 18px; accent-color: var(--accent-color);">
                        <div>
                            <div style="font-weight: 600; color: var(--primary-color);">Seller</div>
                            <div style="font-size: 13px; color: #6b7280;">Can list and manage products</div>
                        </div>
                    </label>
                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                        <input type="radio" name="userRole" value="admin" style="margin-right: 12px; width: 18px; height: 18px; accent-color: var(--accent-color);">
                        <div>
                            <div style="font-weight: 600; color: var(--primary-color);">Admin</div>
                            <div style="font-size: 13px; color: #6b7280;">Full platform access and management</div>
                        </div>
                    </label>
                </div>
            </div>
            <div style="display: flex; gap: 12px; padding: 0 20px 20px 20px;">
                <button class="btn btn-secondary" onclick="closeRoleModal()" style="flex: 1;">Cancel</button>
                <button class="btn btn-primary" onclick="confirmRoleChange()" style="flex: 1;">Change Role</button>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>Add New Product</h2>
                <button class="close-modal" onclick="closeAddProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addProductForm" onsubmit="handleAddProduct(event)">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Product Name *</label>
                            <input type="text" id="productName" required>
                        </div>
                        <div class="form-group">
                            <label>Category *</label>
                            <select id="productCategory" required>
                                <option value="">Select category</option>
                                <option value="electronics">Electronics</option>
                                <option value="fashion">Fashion</option>
                                <option value="home">Home & Garden</option>
                                <option value="sports">Sports & Outdoors</option>
                                <option value="books">Books & Media</option>
                                <option value="toys">Toys & Games</option>
                                <option value="beauty">Beauty & Personal Care</option>
                                <option value="automotive">Automotive</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Price (JMD) *</label>
                            <input type="number" id="productPrice" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Stock Quantity *</label>
                            <input type="number" id="productStock" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Description *</label>
                        <textarea id="productDescription" rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label>Product Images *</label>
                        <input type="file" id="productImages" accept="image/*" multiple onchange="previewProductImages(this)">
                        <small style="color: #6b7280; display: block; margin-top: 4px;">Select up to 5 images (JPG, PNG, GIF, WEBP - max 5MB each)</small>
                    </div>

                    <div class="form-group" id="productImagesPreviewContainer" style="display: none;">
                        <label>Image Previews</label>
                        <div id="productImagesPreview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; margin-top: 8px;">
                            <!-- Image previews will appear here -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Seller (Optional - will use admin if not specified)</label>
                        <select id="productSeller">
                            <option value="">Admin Account</option>
                        </select>
                    </div>

                    <!-- Advanced Options Section (for editing existing products) -->
                    <div id="advancedOptionsSection" style="display: none; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
                        <h3 style="font-size: 18px; font-weight: 600; color: var(--primary-color); margin-bottom: 16px;">Advanced Options</h3>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Product Status</label>
                                <select id="productStatus">
                                    <option value="active">Active (Visible in marketplace)</option>
                                    <option value="inactive">Inactive (Hidden from marketplace)</option>
                                    <option value="draft">Draft (Not yet published)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>SKU / Product Code (Optional)</label>
                                <input type="text" id="productSKU" placeholder="e.g., PROD-001">
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="productFeatured" style="width: 18px; height: 18px; margin-right: 8px; accent-color: var(--accent-color); cursor: pointer;">
                                <span style="font-weight: 500;">Mark as Featured Product</span>
                            </label>
                            <small style="color: #6b7280; display: block; margin-top: 4px; margin-left: 26px;">Featured products appear prominently in the marketplace</small>
                        </div>
                    </div>

                    <!-- Product Info Section (for editing existing products) -->
                    <div id="productInfoSection" style="display: none; margin-top: 24px; padding: 16px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--primary-color); margin-bottom: 12px;">Product Information</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;">
                            <div>
                                <span style="color: #6b7280;">Created:</span>
                                <span id="productCreatedDate" style="font-weight: 500; margin-left: 8px; color: var(--primary-color);">-</span>
                            </div>
                            <div>
                                <span style="color: #6b7280;">Last Updated:</span>
                                <span id="productUpdatedDate" style="font-weight: 500; margin-left: 8px; color: var(--primary-color);">-</span>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                        <button type="button" id="duplicateBtn" class="btn btn-secondary" onclick="duplicateAdminProduct()" style="display: none; margin-right: auto;">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                            Duplicate
                        </button>
                        <button type="button" class="btn" onclick="closeAddProductModal()" style="background: #6b7280;">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="submitProductBtn">Add Product</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Bulk Upload Modal -->
    <div id="adminBulkUploadModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>Bulk Upload Products</h2>
                <button class="close-modal" onclick="closeAdminBulkUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: #e0f2fe; border: 1px solid #7dd3fc; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                    <p style="margin: 0; color: #0c4a6e;"><strong>ðŸ’¡ Admin Tip:</strong> Add multiple products at once. You can assign each product to a specific seller or leave as admin-owned.</p>
                </div>

                <form id="adminBulkUploadForm" onsubmit="handleAdminBulkUpload(event)">
                    <div id="adminBulkProductsContainer">
                        <!-- Product forms will be added dynamically -->
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" onclick="addAdminProductForm()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Another Product
                        </button>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
                        <button type="button" class="btn" onclick="closeAdminBulkUploadModal()" style="background: #6b7280;">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="adminBulkUploadBtn">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            Upload All Products
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Banner Modal -->
    <div id="bannerModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="bannerModalTitle">Add Banner</h2>
                <button class="close-modal" onclick="closeBannerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bannerForm" onsubmit="handleBannerSubmit(event)">
                    <input type="hidden" id="bannerId">

                    <div class="form-group">
                        <label>Category *</label>
                        <select id="bannerCategory" required>
                            <option value="">Select category</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Fashion">Fashion</option>
                            <option value="Home & Garden">Home & Garden</option>
                            <option value="Sports">Sports</option>
                            <option value="Books">Books</option>
                            <option value="Toys">Toys</option>
                            <option value="Beauty">Beauty</option>
                            <option value="Automotive">Automotive</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" id="bannerTitle" required>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="bannerDescription" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Banner Image *</label>
                        <input type="file" id="bannerImageInput" accept="image/*" onchange="previewBannerImage(this)">
                        <small style="color: #6b7280; display: block; margin-top: 4px;">Recommended size: 1200x400px (max 5MB)</small>
                    </div>

                    <div class="form-group">
                        <label>Image Preview</label>
                        <div id="bannerImagePreview" style="width: 100%; height: 200px; background: #f3f4f6; border: 2px dashed #d1d5db; border-radius: 8px; background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                            No image selected
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Display Order</label>
                            <input type="number" id="bannerOrder" min="0" value="0">
                        </div>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                <input type="checkbox" id="bannerActive" checked style="width: 20px; height: 20px; cursor: pointer;">
                                <span>Active</span>
                            </label>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px;">
                        <button type="button" class="btn" onclick="closeBannerModal()" style="background: #6b7280;">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="bannerSubmitBtn">Add Banner</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/supabase-init.js"></script>
    <script src="js/cache-manager.js"></script>
    <script src="js/global-preloader.js"></script>
    <script src="js/supabase-homepage.js"></script>
    <script src="js/session-manager.js"></script>
    <script src="js/toast.js"></script>
    <script>
        // ============================================
        // ADMIN SESSION PROTECTION
        // ============================================

        // Check if user has admin role on page load
        const isAdmin = localStorage.getItem('isAdmin') === 'true';
        const userRole = localStorage.getItem('userRole');

        if (!isAdmin && userRole !== 'admin') {
            alert('Access denied. Admin privileges required.');
            window.location.href = 'auth.html';
        }

        // ============================================
        // NAVIGATION CONFIRMATION DIALOGS
        // ============================================
        // CUSTOM CONFIRM MODAL
        // ============================================

        let confirmCallback = null;

        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            confirmCallback = onConfirm;
            document.getElementById('confirmModal').style.display = 'flex';
        }

        function closeConfirmModal(confirmed) {
            document.getElementById('confirmModal').style.display = 'none';
            if (confirmed && confirmCallback) {
                confirmCallback();
            }
            confirmCallback = null;
        }

        function confirmLeave(url) {
            showConfirmModal(
                'Leave Admin Panel?',
                'Are you sure you want to leave the admin panel?',
                () => window.location.href = url
            );
        }

        // ============================================
        // SUPABASE CLIENT REFERENCE
        // ============================================

        // Supabase is already declared globally in supabase-config.js
        // Just verify it's available
        if (!window.supabaseClient && !supabase) {
            console.error('Supabase client not initialized! Please check supabase-config.js');
            alert('Database connection error. Please refresh the page.');
        }

        // ============================================
        // TAB SWITCHING
        // ============================================

        function switchTab(tabName, event) {
            console.log('switchTab called with:', tabName);

            try {
                // Update nav items
                document.querySelectorAll('.admin-nav-item').forEach(item => {
                    item.classList.remove('active');
                });

                // Find the nav item that was clicked (could be the element itself or a parent)
                if (event) {
                    let navItem = event.target;
                    while (navItem && !navItem.classList.contains('admin-nav-item')) {
                        navItem = navItem.parentElement;
                    }
                    if (navItem) {
                        navItem.classList.add('active');
                    }
                }

                // Update content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                const tabElement = document.getElementById(tabName);
                if (!tabElement) {
                    console.error('Tab element not found:', tabName);
                    alert('Tab not found: ' + tabName);
                    return;
                }
                tabElement.classList.add('active');

                // Load data for the tab
                console.log('Loading data for tab:', tabName);
                if (tabName === 'dashboard') loadDashboard();
                if (tabName === 'products') loadProducts();
                if (tabName === 'users') loadUsers();
                if (tabName === 'sellers') loadSellers();
                if (tabName === 'orders') loadOrders();
                if (tabName === 'homepage') loadHomepage();
                if (tabName === 'settings') loadSettings();

                // Close mobile sidebar after selecting a tab
                if (window.innerWidth <= 768) {
                    toggleAdminSidebar();
                }
            } catch (error) {
                console.error('Error in switchTab:', error);
                alert('Error switching tabs: ' + error.message);
            }
        }

        // Toggle admin sidebar for mobile
        function toggleAdminSidebar() {
            const sidebar = document.querySelector('.admin-sidebar');
            const overlay = document.getElementById('adminOverlay');
            const toggle = document.getElementById('adminMenuToggle');

            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');

            // Change icon
            if (toggle) {
                if (sidebar.classList.contains('active')) {
                    toggle.textContent = 'âœ•';
                } else {
                    toggle.textContent = 'â˜°';
                }
            }
        }

        // ============================================
        // DASHBOARD SECTION
        // ============================================

        async function loadDashboard() {
            try {
                // Get total users count
                const { count: usersCount, error: usersError } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true });

                if (usersError) throw usersError;

                // Get total products count
                const { count: productsCount, error: productsError } = await supabase
                    .from('products')
                    .select('*', { count: 'exact', head: true });

                if (productsError) throw productsError;

                // Get total orders count
                const { count: ordersCount, error: ordersError } = await supabase
                    .from('orders')
                    .select('*', { count: 'exact', head: true });

                if (ordersError) throw ordersError;

                // Get total revenue
                const { data: orders, error: revenueError } = await supabase
                    .from('orders')
                    .select('total');

                if (revenueError) throw revenueError;

                const totalRevenue = orders.reduce((sum, order) => sum + parseFloat(order.total || 0), 0);

                // Update dashboard stats
                document.getElementById('totalUsers').textContent = usersCount || 0;
                document.getElementById('totalProducts').textContent = productsCount || 0;
                document.getElementById('totalOrders').textContent = ordersCount || 0;
                document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2);

            } catch (error) {
                console.error('Error loading dashboard:', error);
                alert('Error loading dashboard statistics: ' + error.message);
            }
        }

        // ============================================
        // PRODUCTS SECTION
        // ============================================

        async function loadProducts() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '<tr><td colspan="8" class="loading-row">Loading products...</td></tr>';

            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select(`
                        id,
                        name,
                        category,
                        price,
                        stock,
                        status,
                        sku,
                        featured,
                        images,
                        seller_id,
                        seller:seller_id (
                            email,
                            full_name
                        )
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!products || products.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">No products found</td></tr>';
                    return;
                }

                tbody.innerHTML = products.map(product => {
                    const images = Array.isArray(product.images) ? product.images : [];
                    const firstImage = images.length > 0 ? images[0] : 'images/placeholder.png';
                    const imageCount = images.length > 1 ? `<small style="color: #6b7280; display: block; margin-top: 2px;">ðŸ“· ${images.length} images</small>` : '';
                    const skuBadge = product.sku ? `<small style="color: #6b7280; display: block; margin-top: 2px;">SKU: ${product.sku}</small>` : '';
                    const featuredBadge = product.featured ? `<span class="badge" style="background: var(--accent-color); color: #111; font-size: 10px; margin-left: 4px;">â­ FEATURED</span>` : '';

                    return `
                    <tr>
                        <td>
                            <img src="${firstImage}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                            ${imageCount}
                        </td>
                        <td>
                            ${product.name}${featuredBadge}
                            ${skuBadge}
                        </td>
                        <td>${product.category}</td>
                        <td>J$${parseFloat(product.price).toFixed(2)}</td>
                        <td>${product.stock}</td>
                        <td>${product.seller?.email || 'Unknown'}</td>
                        <td><span class="badge ${product.status === 'active' ? 'badge-success' : product.status === 'draft' ? 'badge-warning' : 'badge-secondary'}">${product.status || 'active'}</span></td>
                        <td>
                            <div class="action-buttons" style="display: flex; gap: 6px; flex-wrap: wrap;">
                                <button class="btn btn-primary btn-sm" onclick="editAdminProduct('${product.id}')" title="Edit product">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle;">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteProduct('${product.id}')" title="Delete product">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle;">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                }).join('');

            } catch (error) {
                console.error('Error loading products:', error);
                tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; color: red;">Error loading products: ${error.message}</td></tr>`;
            }
        }

        async function editStock(productId, currentStock) {
            const newStock = prompt(`Enter new stock quantity (current: ${currentStock}):`, currentStock);

            if (newStock === null) return; // User cancelled

            const stockValue = parseInt(newStock);
            if (isNaN(stockValue) || stockValue < 0) {
                alert('Please enter a valid stock quantity (0 or greater)');
                return;
            }

            try {
                const { error } = await supabase
                    .from('products')
                    .update({ stock: stockValue })
                    .eq('id', productId);

                if (error) throw error;

                alert('Stock updated successfully!');
                loadProducts();
                loadDashboard(); // Refresh dashboard stats

            } catch (error) {
                console.error('Error updating stock:', error);
                alert('Error updating stock: ' + error.message);
            }
        }

        async function deleteProduct(productId) {
            showConfirmModal(
                'Delete Product?',
                'Are you sure you want to delete this product? This action cannot be undone.',
                async () => {
                    try {
                        const { error } = await supabase
                            .from('products')
                            .delete()
                            .eq('id', productId);

                        if (error) throw error;

                        showSuccess('Product deleted successfully!');
                        loadProducts();
                        loadDashboard(); // Refresh dashboard stats

                    } catch (error) {
                        console.error('Error deleting product:', error);
                        showError('Error deleting product: ' + error.message);
                    }
                }
            );
        }

        // Search Products
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase().trim();
            const tableBody = document.getElementById('productsTableBody');
            const rows = tableBody.getElementsByTagName('tr');

            for (let row of rows) {
                // Skip loading row
                if (row.classList.contains('loading-row') || row.cells.length < 2) continue;

                const name = row.cells[1]?.textContent?.toLowerCase() || '';
                const category = row.cells[2]?.textContent?.toLowerCase() || '';
                const seller = row.cells[5]?.textContent?.toLowerCase() || '';

                if (name.includes(searchTerm) || category.includes(searchTerm) || seller.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }

        // Track editing product ID
        let editingProductId = null;

        // Open add product modal
        async function openAddProductModal() {
            editingProductId = null;
            const modal = document.getElementById('addProductModal');
            const modalTitle = modal.querySelector('h2');
            const submitBtn = document.getElementById('submitProductBtn');

            modalTitle.textContent = 'Add New Product';
            submitBtn.textContent = 'Add Product';

            // Hide advanced sections for new products
            document.getElementById('advancedOptionsSection').style.display = 'none';
            document.getElementById('productInfoSection').style.display = 'none';
            document.getElementById('duplicateBtn').style.display = 'none';

            modal.style.display = 'flex';

            // Load sellers for dropdown
            try {
                const { data: sellers, error } = await supabase
                    .from('users')
                    .select('id, email, full_name')
                    .eq('role', 'seller')
                    .eq('status', 'approved');

                if (!error && sellers) {
                    const sellerSelect = document.getElementById('productSeller');
                    sellerSelect.innerHTML = '<option value="">Admin Account</option>' +
                        sellers.map(seller => `<option value="${seller.id}">${seller.full_name || seller.email}</option>`).join('');
                }
            } catch (error) {
                console.error('Error loading sellers:', error);
            }
        }

        // Close add product modal
        // Store uploaded product images
        let productImagesData = [];

        function previewProductImages(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            if (files.length > 5) {
                showWarning('Maximum 5 images allowed');
                input.value = '';
                return;
            }

            productImagesData = [];
            const previewSection = document.getElementById('productImagesPreviewContainer');

            let processed = 0;

            files.forEach((file, index) => {
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showWarning(`${file.name} is too large (max 5MB)`);
                    return;
                }

                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showWarning(`${file.name} is not an image file`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    productImagesData.push(e.target.result);
                    processed++;

                    if (processed === files.length) {
                        renderProductImagePreviews();
                        previewSection.style.display = 'block';
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function renderProductImagePreviews() {
            const previewContainer = document.getElementById('productImagesPreview');

            previewContainer.innerHTML = productImagesData.map((img, idx) => `
                <div style="position: relative; border: ${idx === 0 ? '3px solid var(--accent-color)' : '2px solid #e5e7eb'}; border-radius: 8px; overflow: hidden;">
                    <img src="${img}" style="width: 100%; height: 100px; object-fit: cover; display: block;">

                    ${idx === 0 ? `
                        <div style="position: absolute; top: 5px; left: 5px; background: var(--accent-color); color: #111; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 700;">PRIMARY</div>
                    ` : ''}

                    <button type="button" onclick="removeProductImage(${idx})" style="position: absolute; top: 4px; right: 4px; background: rgba(239, 68, 68, 0.9); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; padding: 0;">&times;</button>

                    ${productImagesData.length > 1 ? `
                        <div style="position: absolute; bottom: 5px; right: 5px; display: flex; gap: 4px;">
                            ${idx > 0 ? `
                                <button type="button" onclick="moveProductImageUp(${idx})" title="Move left" style="background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 4px; width: 28px; height: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </button>
                            ` : ''}
                            ${idx < productImagesData.length - 1 ? `
                                <button type="button" onclick="moveProductImageDown(${idx})" title="Move right" style="background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 4px; width: 28px; height: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <polyline points="9 18 15 12 9 6"></polyline>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function removeProductImage(index) {
            productImagesData.splice(index, 1);
            const input = document.getElementById('productImages');
            input.value = '';

            const previewSection = document.getElementById('productImagesPreviewContainer');

            if (productImagesData.length === 0) {
                previewSection.style.display = 'none';
                document.getElementById('productImagesPreview').innerHTML = '';
            } else {
                renderProductImagePreviews();
            }
        }

        function moveProductImageUp(index) {
            if (index > 0) {
                [productImagesData[index - 1], productImagesData[index]] = [productImagesData[index], productImagesData[index - 1]];
                renderProductImagePreviews();
            }
        }

        function moveProductImageDown(index) {
            if (index < productImagesData.length - 1) {
                [productImagesData[index], productImagesData[index + 1]] = [productImagesData[index + 1], productImagesData[index]];
                renderProductImagePreviews();
            }
        }

        function closeAddProductModal() {
            const modal = document.getElementById('addProductModal');
            modal.style.display = 'none';
            document.getElementById('addProductForm').reset();
            productImagesData = [];
            editingProductId = null;
            document.getElementById('productImagesPreviewContainer').style.display = 'none';
            document.getElementById('productImagesPreview').innerHTML = '';

            // Reset advanced fields
            document.getElementById('productStatus').value = 'active';
            document.getElementById('productSKU').value = '';
            document.getElementById('productFeatured').checked = false;

            // Hide advanced sections
            document.getElementById('advancedOptionsSection').style.display = 'none';
            document.getElementById('productInfoSection').style.display = 'none';
            document.getElementById('duplicateBtn').style.display = 'none';
        }

        // Edit existing product
        async function editAdminProduct(productId) {
            try {
                // Fetch product data
                const { data: product, error } = await supabase
                    .from('products')
                    .select('*, seller:seller_id(email, full_name)')
                    .eq('id', productId)
                    .single();

                if (error) throw error;

                // Set editing mode
                editingProductId = productId;

                // Update modal title
                const modal = document.getElementById('addProductModal');
                const modalTitle = modal.querySelector('h2');
                const submitBtn = document.getElementById('submitProductBtn');

                modalTitle.textContent = 'Edit Product';
                submitBtn.textContent = 'Update Product';

                // Populate basic fields
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productSeller').value = product.seller_id || '';

                // Populate advanced fields
                document.getElementById('productStatus').value = product.status || 'active';
                document.getElementById('productSKU').value = product.sku || '';
                document.getElementById('productFeatured').checked = product.featured || false;

                // Show advanced sections
                document.getElementById('advancedOptionsSection').style.display = 'block';
                document.getElementById('duplicateBtn').style.display = 'inline-flex';
                document.getElementById('productInfoSection').style.display = 'block';

                // Show product dates
                if (product.created_at) {
                    const created = new Date(product.created_at);
                    document.getElementById('productCreatedDate').textContent = created.toLocaleDateString('en-US', {
                        year: 'numeric', month: 'short', day: 'numeric'
                    });
                }
                if (product.updated_at) {
                    const updated = new Date(product.updated_at);
                    document.getElementById('productUpdatedDate').textContent = updated.toLocaleDateString('en-US', {
                        year: 'numeric', month: 'short', day: 'numeric'
                    });
                }

                // Load existing images
                productImagesData = Array.isArray(product.images) ? [...product.images] : [];
                if (productImagesData.length > 0) {
                    document.getElementById('productImagesPreviewContainer').style.display = 'block';
                    renderProductImagePreviews();
                }

                // Load sellers for dropdown
                const { data: sellers, error: sellersError } = await supabase
                    .from('users')
                    .select('id, email, full_name')
                    .eq('role', 'seller')
                    .eq('status', 'approved');

                if (!sellersError && sellers) {
                    const sellerSelect = document.getElementById('productSeller');
                    sellerSelect.innerHTML = '<option value="">Admin Account</option>' +
                        sellers.map(seller => `<option value="${seller.id}">${seller.full_name || seller.email}</option>`).join('');
                    sellerSelect.value = product.seller_id || '';
                }

                // Show modal
                modal.style.display = 'flex';

            } catch (error) {
                console.error('Error loading product:', error);
                showError('Error loading product: ' + error.message);
            }
        }

        // Duplicate product
        function duplicateAdminProduct() {
            if (!editingProductId) return;

            // Clear editing ID so it saves as new
            editingProductId = null;

            // Update modal title
            const modalTitle = document.querySelector('#addProductModal h2');
            const submitBtn = document.getElementById('submitProductBtn');
            modalTitle.textContent = 'Add New Product (Duplicated)';
            submitBtn.textContent = 'Add Product';

            // Hide duplicate button and product info
            document.getElementById('duplicateBtn').style.display = 'none';
            document.getElementById('productInfoSection').style.display = 'none';

            // Modify product name
            const currentName = document.getElementById('productName').value;
            document.getElementById('productName').value = currentName + ' (Copy)';

            // Clear SKU to avoid conflicts
            document.getElementById('productSKU').value = '';

            // Set status to draft
            document.getElementById('productStatus').value = 'draft';

            showSuccess('Product duplicated! Review details and click "Add Product" to create a copy.');
        }

        // Handle add product form submission
        async function handleAddProduct(event) {
            event.preventDefault();

            const submitBtn = event.target.querySelector('button[type="submit"]');
            const isEditing = editingProductId !== null;
            submitBtn.disabled = true;
            submitBtn.textContent = isEditing ? 'Updating...' : 'Adding...';

            try {
                // Get form data
                const name = document.getElementById('productName').value;
                const category = document.getElementById('productCategory').value;
                const price = parseFloat(document.getElementById('productPrice').value);
                const stock = parseInt(document.getElementById('productStock').value);
                const description = document.getElementById('productDescription').value;
                const sellerId = document.getElementById('productSeller').value;

                // Check if images were uploaded
                if (productImagesData.length === 0) {
                    showWarning('Please upload at least one product image');
                    submitBtn.disabled = false;
                    submitBtn.textContent = isEditing ? 'Update Product' : 'Add Product';
                    return;
                }

                // Use admin's user ID if no seller selected
                const adminUserId = localStorage.getItem('userId');
                const finalSellerId = sellerId || adminUserId;

                if (!finalSellerId) {
                    throw new Error('Unable to determine seller ID');
                }

                // Prepare product data
                const productData = {
                    name: name,
                    category: category,
                    price: price,
                    stock: stock,
                    description: description,
                    images: productImagesData,
                    seller_id: finalSellerId,
                    status: document.getElementById('productStatus').value,
                    sku: document.getElementById('productSKU').value || null,
                    featured: document.getElementById('productFeatured').checked
                };

                let error, data;

                if (isEditing) {
                    // Update existing product
                    ({ data, error } = await supabase
                        .from('products')
                        .update(productData)
                        .eq('id', editingProductId)
                        .select());

                    if (error) throw error;

                    showSuccess('Product updated successfully!');

                    // Invalidate cache
                    if (window.cacheManager) {
                        cacheManager.invalidateProducts();
                    }
                } else {
                    // Insert new product
                    ({ data, error } = await supabase
                        .from('products')
                        .insert(productData)
                        .select());

                    if (error) throw error;

                    showSuccess('Product added successfully!');

                    // Invalidate cache
                    if (window.cacheManager) {
                        cacheManager.invalidateProducts();
                    }
                }

                closeAddProductModal();
                loadProducts();
                loadDashboard(); // Refresh dashboard stats

            } catch (error) {
                console.error('Error saving product:', error);
                showError('Error saving product: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = isEditing ? 'Update Product' : 'Add Product';
            }
        }

        // ============================================
        // ADMIN BULK UPLOAD SECTION
        // ============================================

        let adminBulkProducts = {};
        let adminProductFormCounter = 0;
        let allSellers = []; // Will be populated when modal opens

        // Open admin bulk upload modal
        async function openAdminBulkUploadModal() {
            // Load sellers list
            await loadSellersForBulk();

            // Reset state
            adminBulkProducts = {};
            adminProductFormCounter = 0;

            // Add first product form
            addAdminProductForm();

            // Show modal
            document.getElementById('adminBulkUploadModal').style.display = 'flex';
        }

        // Close admin bulk upload modal
        function closeAdminBulkUploadModal() {
            document.getElementById('adminBulkUploadModal').style.display = 'none';
            document.getElementById('adminBulkProductsContainer').innerHTML = '';
            adminBulkProducts = {};
            adminProductFormCounter = 0;
        }

        // Load sellers for bulk upload dropdown
        async function loadSellersForBulk() {
            try {
                const { data: users, error } = await supabase
                    .from('users')
                    .select('id, email, full_name, role')
                    .in('role', ['seller', 'admin'])
                    .eq('status', 'approved')
                    .order('full_name');

                if (error) throw error;
                allSellers = users || [];
            } catch (error) {
                console.error('Error loading sellers:', error);
                allSellers = [];
            }
        }

        // Add product form
        function addAdminProductForm() {
            const formId = adminProductFormCounter++;
            const container = document.getElementById('adminBulkProductsContainer');

            // Build seller options
            const adminUserId = localStorage.getItem('userId');
            let sellerOptions = `<option value="${adminUserId}">Admin Account (You)</option>`;
            allSellers.forEach(seller => {
                const displayName = seller.full_name || seller.email;
                sellerOptions += `<option value="${seller.id}">${displayName} (${seller.role})</option>`;
            });

            const productFormHTML = `
                <div class="bulk-product-form" id="adminBulkProduct${formId}" style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 24px; margin-bottom: 20px; position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="margin: 0; color: var(--primary-color);">Product #${formId + 1}</h3>
                        ${Object.keys(adminBulkProducts).length > 0 ? `
                            <button type="button" class="btn" onclick="removeAdminProductForm(${formId})" style="background: #ef4444; color: white; padding: 6px 12px; font-size: 13px;">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 4px;">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                Remove
                            </button>
                        ` : ''}
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group" style="margin: 0;">
                            <label>Product Name *</label>
                            <input type="text" id="adminBulkName${formId}" placeholder="Enter product name" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                        </div>

                        <div class="form-group" style="margin: 0;">
                            <label>Price (JMD) *</label>
                            <input type="number" id="adminBulkPrice${formId}" placeholder="0.00" step="0.01" min="0" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                        </div>

                        <div class="form-group" style="margin: 0;">
                            <label>Category *</label>
                            <select id="adminBulkCategory${formId}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                                <option value="">Select category</option>
                                <option value="electronics">Electronics</option>
                                <option value="fashion">Fashion</option>
                                <option value="home">Home & Garden</option>
                                <option value="sports">Sports & Outdoors</option>
                                <option value="books">Books & Media</option>
                                <option value="toys">Toys & Games</option>
                                <option value="beauty">Beauty & Personal Care</option>
                                <option value="automotive">Automotive</option>
                            </select>
                        </div>

                        <div class="form-group" style="margin: 0;">
                            <label>Stock Quantity *</label>
                            <input type="number" id="adminBulkStock${formId}" placeholder="0" min="0" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                        </div>
                    </div>

                    <div class="form-group" style="margin-bottom: 16px;">
                        <label>Description *</label>
                        <textarea id="adminBulkDescription${formId}" placeholder="Product description" rows="3" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; resize: vertical;"></textarea>
                    </div>

                    <div class="form-group" style="margin-bottom: 16px;">
                        <label>Assign to Seller</label>
                        <select id="adminBulkSeller${formId}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                            ${sellerOptions}
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group" style="margin: 0;">
                            <label>Product Status</label>
                            <select id="adminBulkStatus${formId}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="draft">Draft</option>
                            </select>
                        </div>

                        <div class="form-group" style="margin: 0;">
                            <label>SKU (Optional)</label>
                            <input type="text" id="adminBulkSKU${formId}" placeholder="e.g., PROD-001" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                        </div>

                        <div class="form-group" style="margin: 0; display: flex; align-items: center; padding-top: 28px;">
                            <label style="display: flex; align-items: center; cursor: pointer; margin: 0;">
                                <input type="checkbox" id="adminBulkFeatured${formId}" style="width: 18px; height: 18px; margin-right: 8px; accent-color: var(--accent-color); cursor: pointer;">
                                <span style="font-weight: 500;">Featured</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span>Product Images *</span>
                            <span id="adminBulkImageCount${formId}" style="color: #6b7280; font-size: 13px;">0 images</span>
                        </label>
                        <input type="file" id="adminBulkFileInput${formId}" accept="image/*" multiple onchange="handleAdminBulkFileSelect(event, ${formId})" style="width: 100%; padding: 10px; border: 2px dashed #d1d5db; border-radius: 6px; background: white; cursor: pointer;">
                        <small style="color: #6b7280; display: block; margin-top: 6px;">Select multiple images (max 5MB each)</small>
                        <div id="adminBulkImagePreview${formId}" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; margin-top: 12px;">
                            <!-- Image previews -->
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', productFormHTML);
            adminBulkProducts[formId] = { images: [] };
        }

        // Remove product form
        function removeAdminProductForm(formId) {
            document.getElementById(`adminBulkProduct${formId}`).remove();
            delete adminBulkProducts[formId];

            // Renumber remaining forms
            const remainingForms = Object.keys(adminBulkProducts);
            remainingForms.forEach((id, index) => {
                const formElement = document.getElementById(`adminBulkProduct${id}`);
                const heading = formElement.querySelector('h3');
                if (heading) {
                    heading.textContent = `Product #${index + 1}`;
                }
            });
        }

        // Handle file selection for bulk upload
        function handleAdminBulkFileSelect(event, formId) {
            const files = Array.from(event.target.files);
            const maxSize = 5 * 1024 * 1024; // 5MB

            files.forEach(file => {
                if (file.size > maxSize) {
                    showWarning(`Image ${file.name} is too large. Maximum size is 5MB.`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    if (!adminBulkProducts[formId]) {
                        adminBulkProducts[formId] = { images: [] };
                    }
                    adminBulkProducts[formId].images.push(e.target.result);
                    renderAdminBulkImagePreviews(formId);
                };
                reader.readAsDataURL(file);
            });
        }

        // Render image previews
        function renderAdminBulkImagePreviews(formId) {
            const preview = document.getElementById(`adminBulkImagePreview${formId}`);
            const imageCount = document.getElementById(`adminBulkImageCount${formId}`);
            const images = adminBulkProducts[formId]?.images || [];

            preview.innerHTML = images.map((img, idx) => `
                <div style="position: relative; border: ${idx === 0 ? '3px solid var(--accent-color)' : '2px solid #e5e7eb'}; border-radius: 8px; overflow: hidden;">
                    <img src="${img}" style="width: 100%; height: 100px; object-fit: cover; display: block;">

                    ${idx === 0 ? `
                        <div style="position: absolute; top: 4px; left: 4px; background: var(--accent-color); color: #111; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 700;">PRIMARY</div>
                    ` : ''}

                    <button type="button" onclick="removeAdminBulkImage(${formId}, ${idx})" style="position: absolute; top: 4px; right: 4px; background: rgba(239, 68, 68, 0.9); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; line-height: 1; padding: 0;">&times;</button>

                    ${images.length > 1 ? `
                        <div style="position: absolute; bottom: 5px; right: 5px; display: flex; gap: 4px;">
                            ${idx > 0 ? `
                                <button type="button" onclick="moveAdminBulkImageUp(${formId}, ${idx})" title="Move left" style="background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 4px; width: 28px; height: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </button>
                            ` : ''}
                            ${idx < images.length - 1 ? `
                                <button type="button" onclick="moveAdminBulkImageDown(${formId}, ${idx})" title="Move right" style="background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 4px; width: 28px; height: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <polyline points="9 18 15 12 9 6"></polyline>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `).join('');

            // Update image count
            const count = images.length;
            imageCount.textContent = `${count} image${count !== 1 ? 's' : ''}`;
            imageCount.style.color = count > 0 ? '#10b981' : '#6b7280';
        }

        // Remove bulk image
        function removeAdminBulkImage(formId, imgIndex) {
            if (adminBulkProducts[formId] && adminBulkProducts[formId].images) {
                adminBulkProducts[formId].images.splice(imgIndex, 1);
                renderAdminBulkImagePreviews(formId);
            }
        }

        // Move bulk image up (left)
        function moveAdminBulkImageUp(formId, index) {
            const images = adminBulkProducts[formId]?.images;
            if (images && index > 0) {
                [images[index - 1], images[index]] = [images[index], images[index - 1]];
                renderAdminBulkImagePreviews(formId);
            }
        }

        // Move bulk image down (right)
        function moveAdminBulkImageDown(formId, index) {
            const images = adminBulkProducts[formId]?.images;
            if (images && index < images.length - 1) {
                [images[index], images[index + 1]] = [images[index + 1], images[index]];
                renderAdminBulkImagePreviews(formId);
            }
        }

        // Handle bulk upload
        async function handleAdminBulkUpload(event) {
            event.preventDefault();

            const btn = document.getElementById('adminBulkUploadBtn');
            btn.disabled = true;
            btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px; animation: spin 1s linear infinite;"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg> Uploading...';

            try {
                const productsToUpload = [];

                // Collect all product data
                for (const [formId, product] of Object.entries(adminBulkProducts)) {
                    if (!product) continue;

                    const name = document.getElementById(`adminBulkName${formId}`)?.value;
                    const price = document.getElementById(`adminBulkPrice${formId}`)?.value;
                    const category = document.getElementById(`adminBulkCategory${formId}`)?.value;
                    const description = document.getElementById(`adminBulkDescription${formId}`)?.value;
                    const stock = document.getElementById(`adminBulkStock${formId}`)?.value;
                    const sellerId = document.getElementById(`adminBulkSeller${formId}`)?.value;
                    const status = document.getElementById(`adminBulkStatus${formId}`)?.value || 'active';
                    const sku = document.getElementById(`adminBulkSKU${formId}`)?.value || null;
                    const featured = document.getElementById(`adminBulkFeatured${formId}`)?.checked || false;

                    if (!name || !price || !category || !description || !stock || !sellerId) continue;

                    if (!product.images || product.images.length === 0) {
                        showWarning(`Product "${name}" must have at least one image`);
                        btn.disabled = false;
                        btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg> Upload All Products';
                        return;
                    }

                    productsToUpload.push({
                        name,
                        price: parseFloat(price),
                        category,
                        description,
                        stock: parseInt(stock),
                        images: product.images,
                        seller_id: sellerId,
                        status: status,
                        sku: sku,
                        featured: featured
                    });
                }

                if (productsToUpload.length === 0) {
                    showWarning('Please add at least one product with all required fields');
                    btn.disabled = false;
                    btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg> Upload All Products';
                    return;
                }

                // Upload all products
                let successCount = 0;
                let failCount = 0;

                for (const productData of productsToUpload) {
                    try {
                        const { error } = await supabase
                            .from('products')
                            .insert(productData);

                        if (error) {
                            failCount++;
                            console.error(`Failed to upload ${productData.name}:`, error);
                        } else {
                            successCount++;
                        }
                    } catch (error) {
                        failCount++;
                        console.error(`Error uploading ${productData.name}:`, error);
                    }
                }

                // Show results
                if (successCount > 0) {
                    showSuccess(`Successfully uploaded ${successCount} product${successCount > 1 ? 's' : ''}!`);
                    // Invalidate cache to force fresh data
                    cacheManager.invalidateProducts();
                    await loadProducts();
                    loadDashboard(); // Refresh dashboard stats
                    closeAdminBulkUploadModal();
                }

                if (failCount > 0) {
                    showWarning(`${failCount} product${failCount > 1 ? 's' : ''} failed to upload. Check console for details.`);
                }

            } catch (error) {
                console.error('Bulk upload error:', error);
                showError('Error uploading products: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg> Upload All Products';
            }
        }

        // ============================================
        // USERS SECTION
        // ============================================

        async function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '<tr><td colspan="5" class="loading-row">Loading users...</td></tr>';

            try {
                const { data: users, error } = await supabase
                    .from('users')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!users || users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-secondary);">No users found</td></tr>';
                    return;
                }

                tbody.innerHTML = users.map(user => {
                    const roleClass = user.role === 'admin' ? 'badge-danger' :
                                     user.role === 'seller' ? 'badge-warning' : 'badge-success';
                    const createdDate = new Date(user.created_at).toLocaleDateString();

                    return `
                        <tr>
                            <td>${user.email}</td>
                            <td>${user.full_name || 'N/A'}</td>
                            <td><span class="badge ${roleClass}">${user.role}</span></td>
                            <td>${createdDate}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-secondary btn-sm" onclick="changeUserRole('${user.id}', '${user.role}')">Change Role</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteUser('${user.id}')">Delete</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading users:', error);
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: red;">Error loading users: ${error.message}</td></tr>`;
            }
        }

        let currentUserIdForRoleChange = null;

        function changeUserRole(userId, currentRole) {
            currentUserIdForRoleChange = userId;

            // Pre-select the current role
            const radioButtons = document.querySelectorAll('input[name="userRole"]');
            radioButtons.forEach(radio => {
                radio.checked = (radio.value === currentRole);
            });

            // Show modal
            document.getElementById('roleModal').style.display = 'flex';
        }

        function closeRoleModal() {
            document.getElementById('roleModal').style.display = 'none';
            currentUserIdForRoleChange = null;
        }

        async function confirmRoleChange() {
            const selectedRole = document.querySelector('input[name="userRole"]:checked');

            if (!selectedRole) {
                showWarning('Please select a role');
                return;
            }

            const newRole = selectedRole.value;

            try {
                const { error } = await supabase
                    .from('users')
                    .update({ role: newRole })
                    .eq('id', currentUserIdForRoleChange);

                if (error) throw error;

                showSuccess(`User role changed to ${newRole} successfully!`);
                closeRoleModal();
                loadUsers();

            } catch (error) {
                console.error('Error changing user role:', error);
                showError('Error changing user role: ' + error.message);
            }
        }

        // Search Users
        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase().trim();
            const tableBody = document.getElementById('usersTableBody');
            const rows = tableBody.getElementsByTagName('tr');

            for (let row of rows) {
                // Skip loading row
                if (row.classList.contains('loading-row') || row.cells.length < 2) continue;

                const email = row.cells[0]?.textContent?.toLowerCase() || '';
                const fullName = row.cells[1]?.textContent?.toLowerCase() || '';
                const role = row.cells[2]?.textContent?.toLowerCase() || '';

                if (email.includes(searchTerm) || fullName.includes(searchTerm) || role.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }

        // Load pending sellers
        async function loadSellers() {
            const tbody = document.getElementById('sellersTableBody');
            tbody.innerHTML = '<tr><td colspan="5" class="loading-row">Loading sellers...</td></tr>';

            try {
                console.log('Loading sellers from database...');

                const { data: sellers, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('role', 'seller')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error loading sellers:', error);
                    throw error;
                }

                console.log('Sellers loaded:', sellers?.length || 0, sellers);

                if (!sellers || sellers.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-secondary);">No seller accounts found</td></tr>';
                    return;
                }

                tbody.innerHTML = sellers.map(seller => {
                    const status = seller.status || 'pending';
                    const statusClass = status === 'approved' ? 'badge-success' :
                                       status === 'rejected' ? 'badge-danger' : 'badge-warning';
                    const createdDate = new Date(seller.created_at).toLocaleDateString();

                    let actionButtons = '';
                    if (status === 'pending') {
                        actionButtons = `
                            <button class="btn btn-success btn-sm" onclick="approveSeller('${seller.id}')">Approve</button>
                            <button class="btn btn-danger btn-sm" onclick="rejectSeller('${seller.id}')">Reject</button>
                        `;
                    } else if (status === 'rejected') {
                        actionButtons = `
                            <button class="btn btn-success btn-sm" onclick="approveSeller('${seller.id}')">Approve</button>
                        `;
                    } else {
                        actionButtons = `
                            <button class="btn btn-danger btn-sm" onclick="rejectSeller('${seller.id}')">Revoke</button>
                        `;
                    }

                    return `
                        <tr>
                            <td>${seller.email}</td>
                            <td>${seller.full_name || 'N/A'}</td>
                            <td><span class="badge ${statusClass}">${status}</span></td>
                            <td>${createdDate}</td>
                            <td>
                                <div class="action-buttons">
                                    ${actionButtons}
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading sellers:', error);
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: red;">Error loading sellers: ${error.message}</td></tr>`;
            }
        }

        // Approve seller account
        async function approveSeller(userId) {
            showConfirmModal(
                'Approve Seller?',
                'Are you sure you want to approve this seller account? They will be able to list and sell products.',
                async () => {
                    try {
                        const { error } = await supabase
                            .from('users')
                            .update({ status: 'approved' })
                            .eq('id', userId);

                        if (error) throw error;

                        showSuccess('Seller account approved successfully!');
                        loadSellers();

                    } catch (error) {
                        console.error('Error approving seller:', error);
                        showError('Error approving seller: ' + error.message);
                    }
                }
            );
        }

        // Reject seller account
        async function rejectSeller(userId) {
            showConfirmModal(
                'Reject Seller?',
                'Are you sure you want to reject this seller account? They will not be able to sell products.',
                async () => {
                    try {
                        const { error } = await supabase
                            .from('users')
                            .update({ status: 'rejected' })
                            .eq('id', userId);

                        if (error) throw error;

                        showWarning('Seller account rejected.');
                        loadSellers();

                    } catch (error) {
                        console.error('Error rejecting seller:', error);
                        showError('Error rejecting seller: ' + error.message);
                    }
                }
            );
        }

        async function deleteUser(userId) {
            showConfirmModal(
                'Delete User?',
                'Are you sure you want to delete this user? This will also delete all their products, reviews, cart items, and payment information.',
                async () => {
                    try {
                        console.log('Attempting to delete user:', userId);

                        // Database handles cascade deletes automatically
                        const { data, error, count } = await supabase
                            .from('users')
                            .delete({ count: 'exact' })
                            .eq('id', userId);

                        if (error) {
                            console.error('Supabase delete error:', error);

                            // Check if it's an RLS policy error
                            if (error.message.includes('policy') || error.code === '42501') {
                                showError('Permission denied: Please run the admin delete policies migration in Supabase. Check console for SQL.');
                                console.error('âš ï¸ RLS POLICY MISSING! Run this SQL in Supabase:');
                                console.error(`
CREATE POLICY "Admins can delete any user"
    ON public.users FOR DELETE
    USING (
        EXISTS (
            SELECT 1 FROM public.users
            WHERE users.id = auth.uid()
            AND users.role = 'admin'
        )
    );
                                `.trim());
                            } else {
                                showError('Failed to delete user: ' + error.message);
                            }
                            throw error;
                        }

                        console.log('Delete response - Count:', count, 'Data:', data);

                        if (count === 0) {
                            showWarning('User not found or already deleted');
                        } else {
                            console.log('User deleted successfully');
                            showSuccess('User and all related data deleted successfully!');
                        }

                        // Refresh the users list
                        await loadUsers();
                        await loadDashboard(); // Refresh dashboard stats

                    } catch (error) {
                        console.error('Error deleting user:', error);
                        // Error already shown above
                    }
                }
            );
        }

        // ============================================
        // ORDERS SECTION
        // ============================================

        async function loadOrders() {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '<tr><td colspan="6" class="loading-row">Loading orders...</td></tr>';

            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        id,
                        total,
                        status,
                        created_at,
                        buyer_id,
                        users!orders_buyer_id_fkey (
                            email,
                            full_name
                        )
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!orders || orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">No orders found</td></tr>';
                    return;
                }

                tbody.innerHTML = orders.map(order => {
                    const statusClass = order.status === 'delivered' ? 'badge-success' :
                                       order.status === 'cancelled' ? 'badge-danger' :
                                       order.status === 'shipped' ? 'badge-info' : 'badge-warning';
                    const orderDate = new Date(order.created_at).toLocaleDateString();

                    return `
                        <tr>
                            <td>${order.id.substring(0, 8)}...</td>
                            <td>${order.users?.email || 'Unknown'}</td>
                            <td>J$${parseFloat(order.total).toFixed(2)}</td>
                            <td><span class="badge ${statusClass}">${order.status}</span></td>
                            <td>${orderDate}</td>
                            <td>
                                <select class="form-control" onchange="updateOrderStatus('${order.id}', this.value)" style="padding: 6px; font-size: 13px;">
                                    <option value="">Update Status...</option>
                                    <option value="pending" ${order.status === 'pending' ? 'disabled' : ''}>Pending</option>
                                    <option value="processing" ${order.status === 'processing' ? 'disabled' : ''}>Processing</option>
                                    <option value="shipped" ${order.status === 'shipped' ? 'disabled' : ''}>Shipped</option>
                                    <option value="delivered" ${order.status === 'delivered' ? 'disabled' : ''}>Delivered</option>
                                    <option value="cancelled" ${order.status === 'cancelled' ? 'disabled' : ''}>Cancelled</option>
                                </select>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading orders:', error);
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: red;">Error loading orders: ${error.message}</td></tr>`;
            }
        }

        async function updateOrderStatus(orderId, newStatus) {
            if (!newStatus) return; // User didn't select anything

            try {
                const { error } = await supabase
                    .from('orders')
                    .update({ status: newStatus })
                    .eq('id', orderId);

                if (error) throw error;

                alert(`Order status updated to ${newStatus}!`);
                loadOrders();

            } catch (error) {
                console.error('Error updating order status:', error);
                alert('Error updating order status: ' + error.message);
            }
        }

        // ============================================
        // SETTINGS SECTION
        // ============================================

        // Helper function to get setting value
        function getSettingValue(settingsMap, key, defaultValue = '') {
            const value = settingsMap[key];
            if (value === undefined || value === null) return defaultValue;
            return value;
        }

        // Helper function to save setting
        async function saveSetting(key, value) {
            const { error } = await supabase
                .from('platform_settings')
                .upsert({
                    setting_key: key,
                    setting_value: value
                }, {
                    onConflict: 'setting_key'
                });
            if (error) throw error;
        }

        async function loadSettings() {
            try {
                const { data: settings, error } = await supabase
                    .from('platform_settings')
                    .select('*');

                if (error) throw error;

                // Create a map of settings for easy access
                const settingsMap = {};
                settings.forEach(setting => {
                    settingsMap[setting.setting_key] = setting.setting_value;
                });

                // General Settings
                document.getElementById('platformName').value = getSettingValue(settingsMap, 'platform_name', 'London Star Marketplace');
                document.getElementById('platformTagline').value = getSettingValue(settingsMap, 'platform_tagline');
                document.getElementById('platformEmail').value = getSettingValue(settingsMap, 'platform_email');
                document.getElementById('platformPhone').value = getSettingValue(settingsMap, 'platform_phone');
                document.getElementById('currency').value = getSettingValue(settingsMap, 'currency', 'JMD');
                document.getElementById('timezone').value = getSettingValue(settingsMap, 'timezone', 'America/Jamaica');
                document.getElementById('platformDescription').value = getSettingValue(settingsMap, 'platform_description');

                // Business Settings
                document.getElementById('commissionRate').value = getSettingValue(settingsMap, 'commission_rate', '5.00');
                document.getElementById('minOrderAmount').value = getSettingValue(settingsMap, 'min_order_amount');
                document.getElementById('shippingFee').value = getSettingValue(settingsMap, 'shipping_fee');
                document.getElementById('freeShippingThreshold').value = getSettingValue(settingsMap, 'free_shipping_threshold');
                document.getElementById('taxRate').value = getSettingValue(settingsMap, 'tax_rate', '0.00');
                document.getElementById('productsPerPage').value = getSettingValue(settingsMap, 'products_per_page', '24');

                // Seller Settings
                document.getElementById('autoApproveSellers').checked = getSettingValue(settingsMap, 'auto_approve_sellers') === 'true';
                document.getElementById('requireSellerVerification').checked = getSettingValue(settingsMap, 'require_seller_verification') === 'true';
                document.getElementById('maxProductsPerSeller').value = getSettingValue(settingsMap, 'max_products_per_seller');

                // Feature Toggles
                document.getElementById('enableReviews').checked = getSettingValue(settingsMap, 'enable_reviews', 'true') === 'true';
                document.getElementById('enableWishlist').checked = getSettingValue(settingsMap, 'enable_wishlist', 'true') === 'true';
                document.getElementById('enableGuestCheckout').checked = getSettingValue(settingsMap, 'enable_guest_checkout') === 'true';
                document.getElementById('enableNewsletter').checked = getSettingValue(settingsMap, 'enable_newsletter', 'true') === 'true';
                document.getElementById('enableLiveChat').checked = getSettingValue(settingsMap, 'enable_live_chat') === 'true';
                document.getElementById('maintenanceMode').checked = getSettingValue(settingsMap, 'maintenance_mode') === 'true';

                // Social Media
                document.getElementById('facebookUrl').value = getSettingValue(settingsMap, 'facebook_url');
                document.getElementById('instagramUrl').value = getSettingValue(settingsMap, 'instagram_url');
                document.getElementById('twitterUrl').value = getSettingValue(settingsMap, 'twitter_url');
                document.getElementById('linkedinUrl').value = getSettingValue(settingsMap, 'linkedin_url');
                document.getElementById('youtubeUrl').value = getSettingValue(settingsMap, 'youtube_url');
                document.getElementById('tiktokUrl').value = getSettingValue(settingsMap, 'tiktok_url');
                document.getElementById('physicalAddress').value = getSettingValue(settingsMap, 'physical_address');

                // Email Settings
                document.getElementById('emailOrderConfirmation').checked = getSettingValue(settingsMap, 'email_order_confirmation', 'true') === 'true';
                document.getElementById('emailShippingUpdate').checked = getSettingValue(settingsMap, 'email_shipping_update', 'true') === 'true';
                document.getElementById('emailSellerApproval').checked = getSettingValue(settingsMap, 'email_seller_approval', 'true') === 'true';
                document.getElementById('emailNewOrder').checked = getSettingValue(settingsMap, 'email_new_order', 'true') === 'true';
                document.getElementById('emailLowStock').checked = getSettingValue(settingsMap, 'email_low_stock') === 'true';
                document.getElementById('emailWeeklyReport').checked = getSettingValue(settingsMap, 'email_weekly_report') === 'true';
                document.getElementById('emailFromName').value = getSettingValue(settingsMap, 'email_from_name', 'London Star Marketplace');

                // SEO Settings
                document.getElementById('metaTitle').value = getSettingValue(settingsMap, 'meta_title');
                document.getElementById('metaDescription').value = getSettingValue(settingsMap, 'meta_description');
                document.getElementById('metaKeywords').value = getSettingValue(settingsMap, 'meta_keywords');
                document.getElementById('googleAnalyticsId').value = getSettingValue(settingsMap, 'google_analytics_id');
                document.getElementById('facebookPixelId').value = getSettingValue(settingsMap, 'facebook_pixel_id');

            } catch (error) {
                console.error('Error loading settings:', error);
                showError('Error loading settings: ' + error.message);
            }
        }

        // Save General Settings
        async function saveGeneralSettings(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                await saveSetting('platform_name', document.getElementById('platformName').value);
                await saveSetting('platform_tagline', document.getElementById('platformTagline').value);
                await saveSetting('platform_email', document.getElementById('platformEmail').value);
                await saveSetting('platform_phone', document.getElementById('platformPhone').value);
                await saveSetting('currency', document.getElementById('currency').value);
                await saveSetting('timezone', document.getElementById('timezone').value);
                await saveSetting('platform_description', document.getElementById('platformDescription').value);

                showSuccess('General settings saved successfully!');
            } catch (error) {
                console.error('Error saving general settings:', error);
                showError('Error saving settings: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save General Settings';
            }
        }

        // Save Business Settings
        async function saveBusinessSettings(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                await saveSetting('commission_rate', document.getElementById('commissionRate').value);
                await saveSetting('min_order_amount', document.getElementById('minOrderAmount').value);
                await saveSetting('shipping_fee', document.getElementById('shippingFee').value);
                await saveSetting('free_shipping_threshold', document.getElementById('freeShippingThreshold').value);
                await saveSetting('tax_rate', document.getElementById('taxRate').value);
                await saveSetting('products_per_page', document.getElementById('productsPerPage').value);

                showSuccess('Business settings saved successfully!');
            } catch (error) {
                console.error('Error saving business settings:', error);
                showError('Error saving settings: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Business Settings';
            }
        }

        // Save Seller Settings
        async function saveSellerSettings(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                await saveSetting('auto_approve_sellers', document.getElementById('autoApproveSellers').checked.toString());
                await saveSetting('require_seller_verification', document.getElementById('requireSellerVerification').checked.toString());
                await saveSetting('max_products_per_seller', document.getElementById('maxProductsPerSeller').value);

                showSuccess('Seller settings saved successfully!');
            } catch (error) {
                console.error('Error saving seller settings:', error);
                showError('Error saving settings: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Seller Settings';
            }
        }

        // Save Feature Settings
        async function saveFeatureSettings(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                await saveSetting('enable_reviews', document.getElementById('enableReviews').checked.toString());
                await saveSetting('enable_wishlist', document.getElementById('enableWishlist').checked.toString());
                await saveSetting('enable_guest_checkout', document.getElementById('enableGuestCheckout').checked.toString());
                await saveSetting('enable_newsletter', document.getElementById('enableNewsletter').checked.toString());
                await saveSetting('enable_live_chat', document.getElementById('enableLiveChat').checked.toString());
                await saveSetting('maintenance_mode', document.getElementById('maintenanceMode').checked.toString());

                showSuccess('Feature settings saved successfully!');
            } catch (error) {
                console.error('Error saving feature settings:', error);
                showError('Error saving settings: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Feature Settings';
            }
        }

        // Save Social Media Settings
        async function saveSocialSettings(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                await saveSetting('facebook_url', document.getElementById('facebookUrl').value);
                await saveSetting('instagram_url', document.getElementById('instagramUrl').value);
                await saveSetting('twitter_url', document.getElementById('twitterUrl').value);
                await saveSetting('linkedin_url', document.getElementById('linkedinUrl').value);
                await saveSetting('youtube_url', document.getElementById('youtubeUrl').value);
                await saveSetting('tiktok_url', document.getElementById('tiktokUrl').value);
                await saveSetting('physical_address', document.getElementById('physicalAddress').value);

                showSuccess('Social media settings saved successfully!');
            } catch (error) {
                console.error('Error saving social media settings:', error);
                showError('Error saving settings: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Social Media Settings';
            }
        }

        // Save Email Settings
        async function saveEmailSettings(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                await saveSetting('email_order_confirmation', document.getElementById('emailOrderConfirmation').checked.toString());
                await saveSetting('email_shipping_update', document.getElementById('emailShippingUpdate').checked.toString());
                await saveSetting('email_seller_approval', document.getElementById('emailSellerApproval').checked.toString());
                await saveSetting('email_new_order', document.getElementById('emailNewOrder').checked.toString());
                await saveSetting('email_low_stock', document.getElementById('emailLowStock').checked.toString());
                await saveSetting('email_weekly_report', document.getElementById('emailWeeklyReport').checked.toString());
                await saveSetting('email_from_name', document.getElementById('emailFromName').value);

                showSuccess('Email settings saved successfully!');
            } catch (error) {
                console.error('Error saving email settings:', error);
                showError('Error saving settings: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Email Settings';
            }
        }

        // Save SEO Settings
        async function saveSEOSettings(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                await saveSetting('meta_title', document.getElementById('metaTitle').value);
                await saveSetting('meta_description', document.getElementById('metaDescription').value);
                await saveSetting('meta_keywords', document.getElementById('metaKeywords').value);
                await saveSetting('google_analytics_id', document.getElementById('googleAnalyticsId').value);
                await saveSetting('facebook_pixel_id', document.getElementById('facebookPixelId').value);

                showSuccess('SEO settings saved successfully!');
            } catch (error) {
                console.error('Error saving SEO settings:', error);
                showError('Error saving settings: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save SEO Settings';
            }
        }

        // ============================================
        // LOGOUT HANDLER
        // ============================================

        async function handleLogout() {
            showConfirmModal(
                'Sign Out?',
                'Are you sure you want to sign out of the admin panel?',
                async () => {
                    try {
                        // Clear session data
                        sessionManager.clearSession();

                        // Sign out from Supabase
                        const { error } = await supabase.auth.signOut();
                        if (error) console.error('Logout error:', error);

                        // Clear all user-related data
                        localStorage.removeItem('userId');
                        localStorage.removeItem('userEmail');
                localStorage.removeItem('userName');
                localStorage.removeItem('userRole');
                localStorage.removeItem('isAdmin');
                sessionStorage.clear();

                        // Prevent back button by replacing history
                        window.location.replace('index.html');

                    } catch (error) {
                        console.error('Error during logout:', error);
                        // Still redirect even if there's an error
                        sessionManager.clearSession();
                        localStorage.clear();
                        sessionStorage.clear();
                        window.location.replace('index.html');
                    }
                }
            );
        }

        // ============================================
        // HOMEPAGE CUSTOMIZATION SECTION
        // ============================================

        let homepageCardsData = [];

        async function loadHomepage() {
            await loadCurrentHeroBackground();
            await loadCurrentAuthBackground();
            await loadCurrentMarketplaceHero();
            await loadHomepageCardsData();
            syncMarketplaceColors();
        }

        // Hero Background Management
        let heroImages = [];
        let isSlideshowMode = false;

        async function toggleSlideshowMode(enabled) {
            isSlideshowMode = enabled;
            document.getElementById('staticImageSection').style.display = enabled ? 'none' : 'block';
            document.getElementById('slideshowSection').style.display = enabled ? 'block' : 'none';
        }

        async function handleHeroBackgroundUpload(input) {
            const file = input.files[0];
            if (!file) return;

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showWarning('Image size must be less than 5MB');
                input.value = '';
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showWarning('Please select a valid image file');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = async function(e) {
                const imageData = e.target.result;
                heroImages = [imageData];
                updateHeroPreview(imageData);
                showSuccess('Hero background ready to save!');
            };
            reader.readAsDataURL(file);
        }

        async function handleSlideshowUpload(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            heroImages = [];
            let processed = 0;

            for (const file of files) {
                if (file.size > 5 * 1024 * 1024) {
                    showWarning(`${file.name} is too large (max 5MB)`);
                    continue;
                }

                if (!file.type.startsWith('image/')) {
                    showWarning(`${file.name} is not an image file`);
                    continue;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    heroImages.push(e.target.result);
                    processed++;

                    if (processed === files.length) {
                        renderSlideshowImages();
                        showSuccess(`${heroImages.length} images ready to save!`);
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function renderSlideshowImages() {
            const container = document.getElementById('slideshowImagesContainer');
            if (heroImages.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #9ca3af; padding: 40px;">No images uploaded</div>';
                return;
            }

            container.innerHTML = heroImages.map((img, index) => `
                <div style="position: relative; border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <img src="${img}" style="width: 100%; height: 100px; object-fit: cover;">
                    <button onclick="removeSlideshowImage(${index})" style="position: absolute; top: 4px; right: 4px; background: rgba(220, 38, 38, 0.9); color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">Remove</button>
                </div>
            `).join('');
        }

        function removeSlideshowImage(index) {
            heroImages.splice(index, 1);
            renderSlideshowImages();
        }

        function removeAllSlideshowImages() {
            if (confirm('Remove all slideshow images?')) {
                heroImages = [];
                renderSlideshowImages();
                document.getElementById('slideshowInput').value = '';
            }
        }

        async function removeHeroBackground() {
            if (confirm('Are you sure you want to remove the hero background?')) {
                heroImages = [];
                resetHeroPreview();
                await saveHeroSettings();
            }
        }

        async function saveHeroSettings() {
            try {
                const settings = {
                    isSlideshow: isSlideshowMode,
                    images: heroImages
                };

                const { error } = await supabase
                    .from('platform_settings')
                    .upsert({
                        setting_key: 'hero_background',
                        setting_value: settings
                    }, {
                        onConflict: 'setting_key'
                    });

                if (error) throw error;

                alert('Hero settings saved successfully!');
            } catch (error) {
                console.error('Error saving hero settings:', error);
                alert('Error saving settings: ' + error.message);
            }
        }

        async function loadHeroBackgroundPreview() {
            try {
                const { data, error } = await supabase
                    .from('platform_settings')
                    .select('setting_value')
                    .eq('setting_key', 'hero_background')
                    .single();

                if (!error && data && data.setting_value) {
                    const settings = data.setting_value;
                    isSlideshowMode = settings.isSlideshow || false;
                    heroImages = settings.images || [];

                    document.getElementById('slideshowToggle').checked = isSlideshowMode;
                    toggleSlideshowMode(isSlideshowMode);

                    if (isSlideshowMode) {
                        renderSlideshowImages();
                    } else if (heroImages.length > 0) {
                        updateHeroPreview(heroImages[0]);
                    }
                }
            } catch (error) {
                console.error('Error loading hero settings:', error);
            }
        }

        function updateHeroPreview(imageData) {
            const preview = document.getElementById('heroBgPreview');
            if (preview) {
                preview.style.backgroundImage = `url(${imageData})`;
                preview.textContent = '';
            }
        }

        function resetHeroPreview() {
            const preview = document.getElementById('heroBgPreview');
            if (preview) {
                preview.style.backgroundImage = '';
                preview.textContent = 'No background set';
            }
            const input = document.getElementById('heroBgInput');
            if (input) input.value = '';
        }

        // New simplified hero background functions for updated UI
        let currentHeroImageData = null;

        function previewHeroBackground(input) {
            const file = input.files[0];
            if (!file) return;

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showError('Image size must be less than 5MB');
                input.value = '';
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showError('Please select a valid image file');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentHeroImageData = e.target.result;
                document.getElementById('heroPreviewImage').src = currentHeroImageData;
                document.getElementById('heroBackgroundPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        async function saveHeroBackground() {
            if (!currentHeroImageData) {
                showError('Please select an image first');
                return;
            }

            const btn = document.getElementById('saveHeroBtn');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                const settings = {
                    isSlideshow: false,
                    images: [currentHeroImageData]
                };

                const { error } = await supabase
                    .from('platform_settings')
                    .upsert({
                        setting_key: 'hero_background',
                        setting_value: settings
                    }, {
                        onConflict: 'setting_key'
                    });

                if (error) throw error;

                showSuccess('Hero background saved successfully!');
                await loadCurrentHeroBackground();

                // Clear upload
                document.getElementById('heroBackgroundInput').value = '';
                document.getElementById('heroBackgroundPreview').style.display = 'none';
                currentHeroImageData = null;

            } catch (error) {
                console.error('Error saving hero background:', error);
                showError('Error saving background: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Background';
            }
        }

        async function removeHeroBackground() {
            if (!confirm('Are you sure you want to remove the hero background?')) return;

            const btn = document.getElementById('removeHeroBtn');
            btn.disabled = true;
            btn.textContent = 'Removing...';

            try {
                const { error } = await supabase
                    .from('platform_settings')
                    .delete()
                    .eq('setting_key', 'hero_background');

                if (error) throw error;

                showSuccess('Hero background removed successfully!');
                await loadCurrentHeroBackground();

                // Clear upload
                document.getElementById('heroBackgroundInput').value = '';
                document.getElementById('heroBackgroundPreview').style.display = 'none';
                currentHeroImageData = null;

            } catch (error) {
                console.error('Error removing hero background:', error);
                showError('Error removing background: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Remove Background';
            }
        }

        // Auth Background Management
        let currentAuthImageData = null;

        function previewAuthBackground(input) {
            const file = input.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                showError('Image size must be less than 5MB');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentAuthImageData = e.target.result;
                document.getElementById('authPreviewImage').src = currentAuthImageData;
                document.getElementById('authBackgroundPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        async function saveAuthBackground() {
            if (!currentAuthImageData) {
                showError('Please select an image first');
                return;
            }

            const btn = document.getElementById('saveAuthBtn');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                const result = await HomepageDB.saveAuthBackground(currentAuthImageData);

                if (!result.success) {
                    throw new Error(result.error);
                }

                showSuccess('Login page background saved successfully!');
                await loadCurrentAuthBackground();

                // Clear upload
                document.getElementById('authBackgroundInput').value = '';
                document.getElementById('authBackgroundPreview').style.display = 'none';
                currentAuthImageData = null;

            } catch (error) {
                console.error('Error saving auth background:', error);
                showError('Error saving background: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Background';
            }
        }

        async function removeAuthBackground() {
            showConfirmModal(
                'Remove Background?',
                'Are you sure you want to remove the login page background? The default floating bubbles will be restored.',
                async () => {
                    const btn = document.getElementById('removeAuthBtn');
                    btn.disabled = true;
                    btn.textContent = 'Removing...';

                    try {
                        const result = await HomepageDB.removeAuthBackground();

                        if (!result.success) {
                            throw new Error(result.error);
                        }

                        showSuccess('Login page background removed successfully!');
                        await loadCurrentAuthBackground();

                        // Clear upload
                        document.getElementById('authBackgroundInput').value = '';
                        document.getElementById('authBackgroundPreview').style.display = 'none';
                        currentAuthImageData = null;

                    } catch (error) {
                        console.error('Error removing auth background:', error);
                        showError('Error removing background: ' + error.message);
                    } finally {
                        btn.disabled = false;
                        btn.textContent = 'Remove Background';
                    }
                }
            );
        }

        async function loadCurrentAuthBackground() {
            try {
                const result = await HomepageDB.getAuthBackground();

                const currentBg = document.getElementById('currentAuthBackground');

                if (result.success && result.data) {
                    currentBg.style.backgroundImage = `url(${result.data})`;
                    currentBg.textContent = '';
                } else {
                    currentBg.style.backgroundImage = 'none';
                    currentBg.textContent = 'No background set';
                }
            } catch (error) {
                console.error('Error loading current auth background:', error);
            }
        }

        async function loadCurrentHeroBackground() {
            try {
                const { data, error } = await supabase
                    .from('platform_settings')
                    .select('setting_value')
                    .eq('setting_key', 'hero_background')
                    .single();

                const currentBg = document.getElementById('currentHeroBackground');

                if (!error && data && data.setting_value && data.setting_value.images && data.setting_value.images.length > 0) {
                    const imageUrl = data.setting_value.images[0];
                    currentBg.style.backgroundImage = `url(${imageUrl})`;
                    currentBg.textContent = '';
                } else {
                    currentBg.style.backgroundImage = '';
                    currentBg.textContent = 'No background set';
                }
            } catch (error) {
                console.error('Error loading current hero background:', error);
            }
        }

        // Marketplace Hero Background Management
        let currentMarketplaceImageData = null;

        function previewMarketplaceHero(input) {
            const file = input.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                showError('Image size must be less than 5MB');
                input.value = '';
                return;
            }

            if (!file.type.startsWith('image/')) {
                showError('Please select a valid image file');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentMarketplaceImageData = e.target.result;
                document.getElementById('marketplacePreviewImage').src = currentMarketplaceImageData;
                document.getElementById('marketplaceHeroPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        async function saveMarketplaceHero() {
            if (!currentMarketplaceImageData) {
                showError('Please select an image first');
                return;
            }

            const btn = document.getElementById('saveMarketplaceHeroBtn');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                const settings = {
                    isSlideshow: false,
                    images: [currentMarketplaceImageData]
                };

                const { error } = await supabase
                    .from('platform_settings')
                    .upsert({
                        setting_key: 'marketplace_hero_background',
                        setting_value: settings
                    }, {
                        onConflict: 'setting_key'
                    });

                if (error) throw error;

                showSuccess('Marketplace hero background saved successfully!');
                await loadCurrentMarketplaceHero();

                document.getElementById('marketplaceHeroInput').value = '';
                document.getElementById('marketplaceHeroPreview').style.display = 'none';
                currentMarketplaceImageData = null;

            } catch (error) {
                console.error('Error saving marketplace hero background:', error);
                showError('Error saving background: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Background';
            }
        }

        async function removeMarketplaceHero() {
            if (!confirm('Are you sure you want to remove the marketplace hero background?')) return;

            const btn = document.getElementById('removeMarketplaceHeroBtn');
            btn.disabled = true;
            btn.textContent = 'Removing...';

            try {
                const { error } = await supabase
                    .from('platform_settings')
                    .delete()
                    .eq('setting_key', 'marketplace_hero_background');

                if (error) throw error;

                showSuccess('Marketplace hero background removed successfully!');
                await loadCurrentMarketplaceHero();

                document.getElementById('marketplaceHeroInput').value = '';
                document.getElementById('marketplaceHeroPreview').style.display = 'none';
                currentMarketplaceImageData = null;

            } catch (error) {
                console.error('Error removing marketplace hero background:', error);
                showError('Error removing background: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Remove Background';
            }
        }

        async function loadCurrentMarketplaceHero() {
            try {
                const { data, error} = await supabase
                    .from('platform_settings')
                    .select('setting_value')
                    .eq('setting_key', 'marketplace_hero_background')
                    .single();

                const currentBg = document.getElementById('currentMarketplaceHero');

                if (!error && data && data.setting_value && data.setting_value.images && data.setting_value.images.length > 0) {
                    const imageUrl = data.setting_value.images[0];
                    currentBg.style.backgroundImage = `url(${imageUrl})`;
                    currentBg.textContent = '';
                } else {
                    currentBg.style.backgroundImage = '';
                    currentBg.textContent = 'No background set';
                }
            } catch (error) {
                console.error('Error loading current marketplace hero background:', error);
            }

            // Load text colors
            try {
                const { data, error } = await supabase
                    .from('platform_settings')
                    .select('setting_value')
                    .eq('setting_key', 'marketplace_text_colors')
                    .single();

                if (!error && data && data.setting_value) {
                    const titleColor = data.setting_value.titleColor || '#ffffff';
                    const subtitleColor = data.setting_value.subtitleColor || '#ffffff';

                    document.getElementById('marketplaceTitleColor').value = titleColor;
                    document.getElementById('marketplaceTitleColorHex').value = titleColor;
                    document.getElementById('marketplaceSubtitleColor').value = subtitleColor;
                    document.getElementById('marketplaceSubtitleColorHex').value = subtitleColor;
                }
            } catch (error) {
                console.error('Error loading marketplace text colors:', error);
            }
        }

        // Sync color picker with hex input
        function syncMarketplaceColors() {
            const titleColor = document.getElementById('marketplaceTitleColor');
            const titleHex = document.getElementById('marketplaceTitleColorHex');
            const subtitleColor = document.getElementById('marketplaceSubtitleColor');
            const subtitleHex = document.getElementById('marketplaceSubtitleColorHex');

            titleColor.addEventListener('input', (e) => titleHex.value = e.target.value);
            titleHex.addEventListener('input', (e) => {
                if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                    titleColor.value = e.target.value;
                }
            });

            subtitleColor.addEventListener('input', (e) => subtitleHex.value = e.target.value);
            subtitleHex.addEventListener('input', (e) => {
                if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                    subtitleColor.value = e.target.value;
                }
            });
        }

        async function saveMarketplaceTextColors() {
            const titleColor = document.getElementById('marketplaceTitleColorHex').value;
            const subtitleColor = document.getElementById('marketplaceSubtitleColorHex').value;

            try {
                const { error } = await supabase
                    .from('platform_settings')
                    .upsert({
                        setting_key: 'marketplace_text_colors',
                        setting_value: { titleColor, subtitleColor }
                    }, {
                        onConflict: 'setting_key'
                    });

                if (error) throw error;

                showSuccess('Marketplace text colors saved successfully!');
            } catch (error) {
                console.error('Error saving marketplace text colors:', error);
                showError('Error saving text colors: ' + error.message);
            }
        }

        // ============================================
        // BANNER MANAGEMENT
        // ============================================

        let currentBannerImage = null;

        async function loadBanners() {
            const tbody = document.getElementById('bannersTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="loading-row">Loading banners...</td></tr>';

            try {
                const { data: banners, error } = await supabase
                    .from('banners')
                    .select('*')
                    .order('display_order', { ascending: true });

                if (error) throw error;

                if (!banners || banners.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #9ca3af;">No banners found. Click "Add Banner" to create one.</td></tr>';
                    return;
                }

                tbody.innerHTML = banners.map(banner => `
                    <tr>
                        <td>
                            <img src="${banner.image_url}" alt="${banner.title}"
                                style="width: 120px; height: 40px; object-fit: cover; border-radius: 4px;">
                        </td>
                        <td><strong>${banner.category}</strong></td>
                        <td>${banner.title}</td>
                        <td>${banner.description || '-'}</td>
                        <td>
                            <span class="badge ${banner.is_active ? 'badge-success' : 'badge-warning'}">
                                ${banner.is_active ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>${banner.display_order}</td>
                        <td>
                            <button class="btn btn-secondary btn-sm" onclick="editBanner('${banner.id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteBanner('${banner.id}')">Delete</button>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error loading banners:', error);
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: red;">Error loading banners: ${error.message}</td></tr>`;
            }
        }

        function openAddBannerModal() {
            document.getElementById('bannerModalTitle').textContent = 'Add Banner';
            document.getElementById('bannerSubmitBtn').textContent = 'Add Banner';
            document.getElementById('bannerForm').reset();
            document.getElementById('bannerId').value = '';
            document.getElementById('bannerImagePreview').style.backgroundImage = '';
            document.getElementById('bannerImagePreview').textContent = 'No image selected';
            currentBannerImage = null;
            document.getElementById('bannerModal').style.display = 'flex';
        }

        function closeBannerModal() {
            document.getElementById('bannerModal').style.display = 'none';
            document.getElementById('bannerForm').reset();
            currentBannerImage = null;
        }

        function previewBannerImage(input) {
            const file = input.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                showWarning('Image size must be less than 5MB');
                input.value = '';
                return;
            }

            if (!file.type.startsWith('image/')) {
                showWarning('Please select a valid image file');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentBannerImage = e.target.result;
                const preview = document.getElementById('bannerImagePreview');
                preview.style.backgroundImage = `url(${currentBannerImage})`;
                preview.textContent = '';
            };
            reader.readAsDataURL(file);
        }

        async function handleBannerSubmit(event) {
            event.preventDefault();
            const submitBtn = document.getElementById('bannerSubmitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                const bannerId = document.getElementById('bannerId').value;
                const category = document.getElementById('bannerCategory').value;
                const title = document.getElementById('bannerTitle').value;
                const description = document.getElementById('bannerDescription').value;
                const displayOrder = parseInt(document.getElementById('bannerOrder').value) || 0;
                const isActive = document.getElementById('bannerActive').checked;

                const bannerData = {
                    category,
                    title,
                    description,
                    display_order: displayOrder,
                    is_active: isActive
                };

                // Add or update image
                if (currentBannerImage) {
                    bannerData.image_url = currentBannerImage;
                } else if (!bannerId) {
                    showWarning('Please select a banner image');
                    return;
                }

                if (bannerId) {
                    // Update existing banner
                    const { error } = await supabase
                        .from('banners')
                        .update(bannerData)
                        .eq('id', bannerId);

                    if (error) throw error;
                    showSuccess('Banner updated successfully!');
                } else {
                    // Insert new banner
                    const { error } = await supabase
                        .from('banners')
                        .insert(bannerData);

                    if (error) throw error;
                    showSuccess('Banner added successfully!');
                }

                closeBannerModal();
                loadBanners();

            } catch (error) {
                console.error('Error saving banner:', error);
                showError('Error saving banner: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        async function editBanner(bannerId) {
            try {
                const { data: banner, error } = await supabase
                    .from('banners')
                    .select('*')
                    .eq('id', bannerId)
                    .single();

                if (error) throw error;

                document.getElementById('bannerModalTitle').textContent = 'Edit Banner';
                document.getElementById('bannerSubmitBtn').textContent = 'Update Banner';
                document.getElementById('bannerId').value = banner.id;
                document.getElementById('bannerCategory').value = banner.category;
                document.getElementById('bannerTitle').value = banner.title;
                document.getElementById('bannerDescription').value = banner.description || '';
                document.getElementById('bannerOrder').value = banner.display_order;
                document.getElementById('bannerActive').checked = banner.is_active;

                // Show current image
                const preview = document.getElementById('bannerImagePreview');
                preview.style.backgroundImage = `url(${banner.image_url})`;
                preview.textContent = '';
                currentBannerImage = banner.image_url;

                document.getElementById('bannerModal').style.display = 'flex';

            } catch (error) {
                console.error('Error loading banner:', error);
                alert('Error loading banner: ' + error.message);
            }
        }

        async function deleteBanner(bannerId) {
            showConfirmModal(
                'Delete Banner?',
                'Are you sure you want to delete this banner?',
                async () => {
                    try {
                        const { error } = await supabase
                            .from('banners')
                            .delete()
                            .eq('id', bannerId);

                        if (error) throw error;

                        showSuccess('Banner deleted successfully!');
                        loadBanners();

                    } catch (error) {
                        console.error('Error deleting banner:', error);
                        showError('Error deleting banner: ' + error.message);
                    }
                }
            );
        }

        // Homepage Cards Management
        async function loadHomepageCardsData() {
            // Try Supabase first, fallback to localStorage
            if (typeof HomepageDB !== 'undefined') {
                const result = await HomepageDB.getCards();
                homepageCardsData = result.data || getDefaultHomepageCards();
            } else {
                const stored = localStorage.getItem('homepageCards');
                homepageCardsData = stored ? JSON.parse(stored) : getDefaultHomepageCards();
            }
            renderHomepageCards();
        }

        function getDefaultHomepageCards() {
            return [
                {
                    title: 'Shop by Category',
                    tiles: [
                        { label: 'Electronics', category: 'electronics' },
                        { label: 'Fashion', category: 'fashion' },
                        { label: 'Home & Kitchen', category: 'home' },
                        { label: 'Beauty & Care', category: 'beauty' }
                    ],
                    link: 'marketplace.html',
                    linkText: 'Shop all categories'
                },
                {
                    title: 'Refresh your space',
                    tiles: [
                        { label: 'Living Room', category: 'home' },
                        { label: 'Bedding', category: 'home' },
                        { label: 'Decor', category: 'home' },
                        { label: 'Storage', category: 'home' }
                    ],
                    link: 'marketplace.html?category=home',
                    linkText: 'See more'
                },
                {
                    title: 'Electronics',
                    tiles: [
                        { label: 'Laptops', category: 'electronics' },
                        { label: 'Phones', category: 'electronics' },
                        { label: 'Headsets', category: 'electronics' },
                        { label: 'Accessories', category: 'electronics' }
                    ],
                    link: 'marketplace.html?category=electronics',
                    linkText: 'See deals in Electronics'
                }
            ];
        }

        function renderHomepageCards() {
            const container = document.getElementById('homepageCardsContainer');
            if (!container) return;

            container.innerHTML = homepageCardsData.map((card, idx) => `
                <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">Card ${idx + 1}: ${card.title}</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                        ${card.tiles.map(tile => `
                            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px; text-align: center;">
                                ${tile.label}
                            </div>
                        `).join('')}
                    </div>
                    <div style="color: #6b7280; font-size: 13px;">
                        Link: ${card.link} | Text: "${card.linkText}"
                    </div>
                </div>
            `).join('');
        }

        async function saveHomepageCards() {
            if (typeof HomepageDB !== 'undefined') {
                const result = await HomepageDB.saveCards(homepageCardsData);
                if (result.success) {
                    alert('Homepage cards saved successfully!');
                } else {
                    alert('Error saving cards: ' + result.error);
                }
            } else {
                localStorage.setItem('homepageCards', JSON.stringify(homepageCardsData));
                alert('Homepage cards saved successfully!');
            }
        }

        function resetHomepageCards() {
            if (confirm('Reset all cards to default settings?')) {
                homepageCardsData = getDefaultHomepageCards();
                renderHomepageCards();
                saveHomepageCards();
            }
        }

        // ============================================
        // INITIALIZE
        // ============================================

        // Load dashboard on page load - Use DOMContentLoaded for faster loading
        document.addEventListener('DOMContentLoaded', () => {
            // Settings form handlers
            const generalSettingsForm = document.getElementById('generalSettingsForm');
            if (generalSettingsForm) {
                generalSettingsForm.addEventListener('submit', saveGeneralSettings);
            }

            const businessSettingsForm = document.getElementById('businessSettingsForm');
            if (businessSettingsForm) {
                businessSettingsForm.addEventListener('submit', saveBusinessSettings);
            }

            const sellerSettingsForm = document.getElementById('sellerSettingsForm');
            if (sellerSettingsForm) {
                sellerSettingsForm.addEventListener('submit', saveSellerSettings);
            }

            const featureSettingsForm = document.getElementById('featureSettingsForm');
            if (featureSettingsForm) {
                featureSettingsForm.addEventListener('submit', saveFeatureSettings);
            }

            const socialSettingsForm = document.getElementById('socialSettingsForm');
            if (socialSettingsForm) {
                socialSettingsForm.addEventListener('submit', saveSocialSettings);
            }

            const emailSettingsForm = document.getElementById('emailSettingsForm');
            if (emailSettingsForm) {
                emailSettingsForm.addEventListener('submit', saveEmailSettings);
            }

            const seoSettingsForm = document.getElementById('seoSettingsForm');
            if (seoSettingsForm) {
                seoSettingsForm.addEventListener('submit', saveSEOSettings);
            }

            loadDashboard();
        });
    </script>

    <!-- Vercel Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
